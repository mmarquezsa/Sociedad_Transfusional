<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel de Administraci√≥n - SOCHIMT</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'sochimt': {
              50: '#eff6ff',
              100: '#dbeafe', 
              200: '#bfdbfe',
              300: '#93c5fd',
              400: '#60a5fa',
              500: '#3b82f6',
              600: '#2563eb',
              700: '#1d4ed8',
              800: '#1e40af',
              900: '#1e3a8a',
            },
            'medical': {
              50: '#fef2f2',
              100: '#fee2e2',
              200: '#fecaca', 
              300: '#fca5a5',
              400: '#f87171',
              500: '#ef4444',
              600: '#dc2626',
              700: '#b91c1c',
              800: '#991b1b',
              900: '#7f1d1d',
            }
          }
        }
      }
    }
  </script>
  <style>
    /* Estilos base */
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    }
    
    /* Indicadores de sincronizaci√≥n */
    .sync-badge {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(34, 197, 94, 0.9);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
      backdrop-filter: blur(10px);
    }
    
    .sync-badge.show {
      opacity: 1;
    }

    .sync-badge.error {
      background: rgba(239, 68, 68, 0.9);
    }

    /* Bot√≥n flotante de sincronizaci√≥n */
    .fab-sync {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
      cursor: pointer;
      z-index: 1000;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .fab-sync:hover {
      background: #1d4ed8;
      transform: scale(1.1);
    }

    .fab-sync.syncing {
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Mejoras para m√≥viles */
    @media (max-width: 640px) {
      .sync-badge {
        top: 10px;
        right: 10px;
        font-size: 12px;
        padding: 6px 12px;
      }
      
      .fab-sync {
        bottom: 70px;
        right: 15px;
        width: 48px;
        height: 48px;
      }
    }

    /* Loading skeleton */
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Estados de debug */
    .debug-panel {
      position: fixed;
      bottom: 80px;
      right: 20px;
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      max-width: 300px;
      font-size: 12px;
      display: none;
      z-index: 999;
    }

    .debug-panel.show {
      display: block;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-blue-50 min-h-screen">

  <!-- Login Screen -->
  <div id="login-screen" class="min-h-screen flex items-center justify-center p-4">
    <div class="bg-white/80 backdrop-blur-lg p-8 rounded-3xl shadow-2xl max-w-md w-full border border-white/20">
      <div class="text-center mb-8">
        <div class="h-24 w-24 bg-gradient-to-br from-sochimt-600 to-sochimt-700 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg">
          <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
          </svg>
        </div>
        <h1 class="text-3xl font-black text-gray-800 mb-2">Panel Administrativo</h1>
        <p class="text-gray-600 font-medium">SOCHIMT - Gesti√≥n de Contenido</p>
      </div>

      <form id="login-form" class="space-y-6">
        <div>
          <label for="username" class="block text-sm font-bold text-gray-700 mb-2">üë§ Usuario</label>
          <input type="text" id="username" required 
                 class="w-full px-6 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-sochimt-200 focus:border-sochimt-500 transition-all duration-300">
        </div>
        <div>
          <label for="password" class="block text-sm font-bold text-gray-700 mb-2">üîê Contrase√±a</label>
          <input type="password" id="password" required 
                 class="w-full px-6 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-sochimt-200 focus:border-sochimt-500 transition-all duration-300">
        </div>
        <button type="submit" 
                class="w-full bg-gradient-to-r from-sochimt-600 to-sochimt-700 text-white py-4 px-6 rounded-xl hover:from-sochimt-700 hover:to-sochimt-800 transition-all duration-300 font-bold text-lg shadow-lg hover:shadow-xl transform hover:scale-105">
          ‚ú® Acceder al Panel
        </button>
      </form>

      <div id="login-error" class="hidden mt-6 p-4 bg-red-100 border-l-4 border-red-500 text-red-700 rounded-lg">
        <div class="flex items-center">
          <span class="text-xl mr-2">‚ö†Ô∏è</span>
          <span>Usuario o contrase√±a incorrectos</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Admin Panel -->
  <div id="admin-panel" class="hidden min-h-screen">
    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-lg shadow-lg sticky top-0 z-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4">
        <div class="flex justify-between items-center">
          <div class="flex items-center space-x-4">
            <h1 class="text-xl sm:text-2xl font-black text-gray-800">Panel de Administraci√≥n</h1>
          </div>
          <div class="flex items-center space-x-4">
            <div id="sync-status" class="hidden sm:flex items-center space-x-2">
              <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
              <span class="text-sm text-gray-600">Sincronizado</span>
            </div>
            <span id="current-user" class="font-bold text-sochimt-600 text-sm sm:text-base"></span>
            <button id="logout-btn" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-all duration-300">
              Salir
            </button>
          </div>
        </div>
      </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-8">
      <!-- Add News Form -->
      <div class="bg-white rounded-2xl shadow-lg p-6 sm:p-8 mb-8">
        <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-6">‚ûï Agregar Nueva Noticia</h2>
        
        <form id="news-form" class="space-y-6">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div>
              <label for="news-title" class="block text-sm font-bold text-gray-700 mb-2">üìù T√≠tulo *</label>
              <input type="text" id="news-title" required 
                     class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-sochimt-200 focus:border-sochimt-500 transition-all duration-300"
                     placeholder="T√≠tulo de la noticia...">
            </div>
            <div>
              <label for="news-category" class="block text-sm font-bold text-gray-700 mb-2">üè∑Ô∏è Categor√≠a *</label>
              <select id="news-category" required 
                      class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-sochimt-200 focus:border-sochimt-500 transition-all duration-300">
                <option value="">Seleccionar categor√≠a</option>
                <option value="Evento">üéâ Evento</option>
                <option value="Publicaci√≥n">üìö Publicaci√≥n</option>
                <option value="Webinar">üíª Webinar</option>
                <option value="Congreso">üèõÔ∏è Congreso</option>
                <option value="Noticia">üì∞ Noticia General</option>
              </select>
            </div>
          </div>
          
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div>
              <label for="news-date" class="block text-sm font-bold text-gray-700 mb-2">üìÖ Fecha *</label>
              <input type="date" id="news-date" required 
                     class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-sochimt-200 focus:border-sochimt-500 transition-all duration-300">
            </div>
            <div>
              <label for="news-url" class="block text-sm font-bold text-gray-700 mb-2">üîó URL (opcional)</label>
              <input type="url" id="news-url" placeholder="https://..." 
                     class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-sochimt-200 focus:border-sochimt-500 transition-all duration-300">
            </div>
          </div>
          
          <!-- Secci√≥n de carga de archivos simplificada -->
          <div>
            <label for="news-image" class="block text-sm font-bold text-gray-700 mb-2">üñºÔ∏è Imagen (opcional)</label>
            <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-sochimt-500 transition-all duration-300">
              <input type="file" id="news-image" accept="image/*" 
                     class="hidden" onchange="handleFileUpload(this)">
              <div id="file-upload-area" onclick="document.getElementById('news-image').click()" class="cursor-pointer">
                <div class="text-4xl mb-4">üìé</div>
                <p class="text-gray-600 font-medium mb-2">Haz clic para seleccionar imagen</p>
                <p class="text-sm text-gray-500">JPG, PNG, GIF (M√°x. 5MB)</p>
              </div>
              <div id="file-preview" class="hidden mt-4">
                <div id="preview-content"></div>
                <button type="button" onclick="removeFile()" class="mt-3 px-4 py-2 bg-red-500 text-white rounded-lg text-sm hover:bg-red-600 transition-colors">
                  üóëÔ∏è Eliminar
                </button>
              </div>
            </div>
          </div>
          
          <div>
            <label for="news-summary" class="block text-sm font-bold text-gray-700 mb-2">üìÑ Resumen *</label>
            <textarea id="news-summary" rows="4" required 
                      class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-sochimt-200 focus:border-sochimt-500 transition-all duration-300 resize-none"
                      placeholder="Describe brevemente la noticia..."></textarea>
          </div>
          
          <div class="flex justify-end space-x-4">
            <button type="button" id="cancel-edit" class="hidden px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all duration-300 font-medium">
              Cancelar
            </button>
            <button type="submit" id="submit-news" 
                    class="px-6 py-3 bg-gradient-to-r from-sochimt-600 to-sochimt-700 text-white rounded-xl hover:from-sochimt-700 hover:to-sochimt-800 transition-all duration-300 font-bold shadow-lg hover:shadow-xl">
              ‚ú® Publicar Noticia
            </button>
          </div>
        </form>
      </div>

      <!-- News List -->
      <div class="bg-white rounded-2xl shadow-lg p-6 sm:p-8">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 space-y-4 sm:space-y-0">
          <h2 class="text-xl sm:text-2xl font-bold text-gray-800">üìã Noticias Publicadas</h2>
          <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-4 w-full sm:w-auto">
            <input type="text" id="search-news" placeholder="üîç Buscar..." 
                   class="px-4 py-2 border-2 border-gray-200 rounded-xl text-sm focus:ring-4 focus:ring-sochimt-200 focus:border-sochimt-500 transition-all duration-300 w-full sm:w-64">
            <button onclick="exportData()" class="px-4 py-2 bg-green-600 text-white rounded-xl hover:bg-green-700 text-sm font-bold transition-all duration-300 w-full sm:w-auto">
              üì§ Exportar
            </button>
          </div>
        </div>

        <div id="news-list" class="space-y-4">
          <!-- News items will be loaded here -->
        </div>

        <div id="no-news" class="hidden text-center py-16">
          <div class="text-gray-400 text-6xl mb-4">üì∞</div>
          <h3 class="text-xl font-bold text-gray-900 mb-2">No hay noticias publicadas</h3>
          <p class="text-gray-500">Agrega tu primera noticia usando el formulario de arriba.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification Badge -->
  <div id="sync-badge" class="sync-badge">
    <span id="sync-message">Sincronizando...</span>
  </div>

  <!-- Floating Action Button for Sync -->
  <button id="fab-sync" class="fab-sync" onclick="forceSyncWithWebsite()" title="Sincronizar con el sitio web">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
    </svg>
  </button>

  <!-- Debug Panel -->
  <div id="debug-panel" class="debug-panel">
    <h4 class="font-bold mb-2">üîß Debug Info</h4>
    <div id="debug-content"></div>
  </div>

  <!-- Success/Error Notifications -->
  <div id="notification" class="fixed top-4 right-4 p-6 rounded-2xl shadow-2xl hidden z-50 transform transition-all duration-300"></div>

  <script>
    // Configuraci√≥n global
    const CONFIG = {
      users: {
        'admin': 'marcelo',
        'editora': 'silvia',
        'gestor': 'marcelo'
      },
      storageKey: 'sochimt_news_data',
      publicKey: 'sochimt_public_news',
      sessionKey: 'sochimt_session',
      maxImageSize: 5 * 1024 * 1024, // 5MB
      debugMode: true // Activar modo debug
    };

    // Estado global
    let currentUser = null;
    let editingId = null;
    let newsData = [];
    let selectedFile = null;
    let selectedFileData = null;

    // Elementos DOM
    const loginScreen = document.getElementById('login-screen');
    const adminPanel = document.getElementById('admin-panel');
    const loginForm = document.getElementById('login-form');
    const newsForm = document.getElementById('news-form');
    const newsList = document.getElementById('news-list');
    const noNews = document.getElementById('no-news');

    // Inicializaci√≥n
    document.addEventListener('DOMContentLoaded', () => {
      console.log('üöÄ Iniciando Panel de Administraci√≥n SOCHIMT');
      
      // Cargar datos existentes
      loadDataFromStorage();
      
      // Verificar sesi√≥n
      checkSession();
      
      // Configurar event listeners
      setupEventListeners();
      
      // Establecer fecha por defecto
      setDefaultDate();
      
      // Iniciar sincronizaci√≥n autom√°tica
      setInterval(autoSync, 30000); // Cada 30 segundos
      
      // Debug inicial
      if (CONFIG.debugMode) {
        updateDebugPanel();
      }
    });

    // Cargar datos desde localStorage
    function loadDataFromStorage() {
      try {
        const stored = localStorage.getItem(CONFIG.storageKey);
        if (stored) {
          newsData = JSON.parse(stored);
          console.log(`üì∞ ${newsData.length} noticias cargadas desde localStorage`);
        }
      } catch (e) {
        console.error('Error cargando datos:', e);
        newsData = [];
      }
    }

    // Verificar sesi√≥n existente
    function checkSession() {
      const session = sessionStorage.getItem(CONFIG.sessionKey);
      if (session) {
        currentUser = session;
        showAdminPanel();
      }
    }

    // Configurar event listeners
    function setupEventListeners() {
      loginForm.addEventListener('submit', handleLogin);
      document.getElementById('logout-btn').addEventListener('click', logout);
      newsForm.addEventListener('submit', handleNewsSubmit);
      document.getElementById('cancel-edit').addEventListener('click', cancelEdit);
      document.getElementById('search-news').addEventListener('input', filterNews);
      
      // Debug mode toggle
      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.shiftKey && e.key === 'D') {
          toggleDebugPanel();
        }
      });
    }

    // Establecer fecha por defecto
    function setDefaultDate() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('news-date').value = today;
    }

    // Manejo de login
    function handleLogin(e) {
      e.preventDefault();
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      if (CONFIG.users[username] && CONFIG.users[username] === password) {
        currentUser = username;
        sessionStorage.setItem(CONFIG.sessionKey, username);
        showAdminPanel();
        showNotification('¬°Bienvenido al panel de administraci√≥n! üéâ', 'success');
      } else {
        document.getElementById('login-error').classList.remove('hidden');
        setTimeout(() => {
          document.getElementById('login-error').classList.add('hidden');
        }, 5000);
      }
    }

    // Mostrar panel de administraci√≥n
    function showAdminPanel() {
      loginScreen.classList.add('hidden');
      adminPanel.classList.remove('hidden');
      document.getElementById('current-user').textContent = currentUser;
      loadNews();
    }

    // Logout
    function logout() {
      sessionStorage.removeItem(CONFIG.sessionKey);
      currentUser = null;
      adminPanel.classList.add('hidden');
      loginScreen.classList.remove('hidden');
      loginForm.reset();
      showNotification('Sesi√≥n cerrada correctamente üëã', 'info');
    }

    // Manejar carga de archivos
    function handleFileUpload(input) {
      const file = input.files[0];
      if (!file) return;

      // Validar tama√±o
      if (file.size > CONFIG.maxImageSize) {
        showNotification('‚ùå La imagen es demasiado grande. M√°ximo 5MB permitido.', 'error');
        input.value = '';
        return;
      }

      // Validar tipo
      const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
      if (!validTypes.includes(file.type)) {
        showNotification('‚ùå Tipo de archivo no v√°lido. Solo se permiten im√°genes.', 'error');
        input.value = '';
        return;
      }

      selectedFile = file;
      
      // Comprimir y convertir a base64
      const reader = new FileReader();
      reader.onload = function(e) {
        // Comprimir imagen si es necesario
        compressImage(e.target.result, (compressedData) => {
          selectedFileData = compressedData;
          showFilePreview(file, compressedData);
        });
      };
      reader.readAsDataURL(file);
    }

    // Comprimir imagen
    function compressImage(dataUrl, callback) {
      const img = new Image();
      img.onload = function() {
        const canvas = document.createElement('canvas');
        let width = img.width;
        let height = img.height;
        
        // Limitar tama√±o m√°ximo
        const maxSize = 800;
        if (width > height && width > maxSize) {
          height = (height * maxSize) / width;
          width = maxSize;
        } else if (height > maxSize) {
          width = (width * maxSize) / height;
          height = maxSize;
        }
        
        canvas.width = width;
        canvas.height = height;
        
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0, width, height);
        
        // Comprimir a JPEG con calidad del 80%
        const compressedData = canvas.toDataURL('image/jpeg', 0.8);
        callback(compressedData);
      };
      img.src = dataUrl;
    }

    // Mostrar preview del archivo
    function showFilePreview(file, dataUrl) {
      const uploadArea = document.getElementById('file-upload-area');
      const preview = document.getElementById('file-preview');
      const previewContent = document.getElementById('preview-content');

      uploadArea.style.display = 'none';
      preview.classList.remove('hidden');

      previewContent.innerHTML = `
        <img src="${dataUrl}" alt="Preview" class="max-w-full h-48 object-cover rounded-lg mx-auto">
        <p class="mt-2 text-sm text-gray-600 font-medium">${file.name}</p>
        <p class="text-xs text-gray-500">${(file.size / 1024 / 1024).toFixed(2)} MB</p>
      `;
    }

    // Eliminar archivo seleccionado
    function removeFile() {
      selectedFile = null;
      selectedFileData = null;
      document.getElementById('news-image').value = '';
      document.getElementById('file-upload-area').style.display = 'block';
      document.getElementById('file-preview').classList.add('hidden');
    }

    // Manejo de formulario de noticias
    function handleNewsSubmit(e) {
      e.preventDefault();
      
      const formData = {
        id: editingId || Date.now().toString(),
        titulo: document.getElementById('news-title').value,
        categoria: document.getElementById('news-category').value,
        fecha: formatDate(document.getElementById('news-date').value),
        fechaRaw: document.getElementById('news-date').value,
        resumen: document.getElementById('news-summary').value,
        url: document.getElementById('news-url').value || '#',
        imagen: selectedFileData || getDefaultImageForCategory(document.getElementById('news-category').value),
        imagenNombre: selectedFile ? selectedFile.name : null,
        imagenTipo: selectedFile ? selectedFile.type : null,
        autor: currentUser,
        fechaCreacion: editingId ? newsData.find(n => n.id === editingId).fechaCreacion : new Date().toISOString(),
        estado: 'publicada'
      };

      if (editingId) {
        const index = newsData.findIndex(n => n.id === editingId);
        if (!selectedFileData) {
          const oldNews = newsData[index];
          formData.imagen = oldNews.imagen;
          formData.imagenNombre = oldNews.imagenNombre;
          formData.imagenTipo = oldNews.imagenTipo;
        }
        newsData[index] = formData;
        showNotification('‚úÖ Noticia actualizada correctamente', 'success');
      } else {
        newsData.unshift(formData);
        showNotification('üéâ ¬°Noticia publicada exitosamente!', 'success');
      }

      saveData();
      syncWithWebsite();
      loadNews();
      newsForm.reset();
      setDefaultDate();
      cancelEdit();
      removeFile();
    }

    // Obtener imagen por defecto seg√∫n categor√≠a
    function getDefaultImageForCategory(category) {
      // URLs de im√°genes locales o por defecto
      const images = {
        'Evento': 'evento-default.jpg',
        'Publicaci√≥n': 'publicacion-default.jpg',
        'Webinar': 'webinar-default.jpg',
        'Congreso': 'congreso-default.jpg',
        'Noticia': 'noticia-default.jpg'
      };
      return images[category] || 'noticia-default.jpg';
    }

    // Formatear fecha
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      const options = { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric'
      };
      return date.toLocaleDateString('es-CL', options);
    }

    // Cargar noticias
    function loadNews() {
      if (newsData.length === 0) {
        newsList.innerHTML = '';
        noNews.classList.remove('hidden');
        return;
      }

      noNews.classList.add('hidden');
      newsList.innerHTML = newsData.map(news => `
        <div class="bg-gray-50 rounded-xl p-4 sm:p-6 hover:shadow-lg transition-all duration-300">
          <div class="flex flex-col sm:flex-row justify-between items-start">
            <div class="flex-1 mb-4 sm:mb-0">
              <div class="flex flex-wrap items-center gap-2 mb-3">
                <span class="px-3 py-1 bg-sochimt-600 text-white rounded-full text-xs font-bold">
                  ${news.categoria}
                </span>
                <span class="text-xs text-gray-600">üìÖ ${news.fecha}</span>
                <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-bold">‚úÖ Publicada</span>
              </div>
              <h3 class="text-lg font-bold text-gray-800 mb-2">${news.titulo}</h3>
              <p class="text-sm text-gray-600 mb-3 line-clamp-2">${news.resumen}</p>
              <div class="text-xs text-gray-500">
                <span>üë§ ${news.autor}</span>
                <span class="mx-2">‚Ä¢</span>
                <span>üïí ${new Date(news.fechaCreacion).toLocaleDateString('es-CL')}</span>
              </div>
            </div>
            <div class="flex items-center space-x-2">
              <button onclick="editNews('${news.id}')" 
                      class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-300" 
                      title="Editar">
                ‚úèÔ∏è
              </button>
              <button onclick="deleteNews('${news.id}')" 
                      class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-all duration-300" 
                      title="Eliminar">
                üóëÔ∏è
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Editar noticia
    function editNews(id) {
      const news = newsData.find(n => n.id === id);
      if (!news) return;

      document.getElementById('news-title').value = news.titulo;
      document.getElementById('news-category').value = news.categoria;
      document.getElementById('news-date').value = news.fechaRaw;
      document.getElementById('news-summary').value = news.resumen;
      document.getElementById('news-url').value = news.url === '#' ? '' : news.url;

      if (news.imagen && news.imagenNombre && news.imagen.startsWith('data:')) {
        selectedFileData = news.imagen;
        const preview = document.getElementById('file-preview');
        const previewContent = document.getElementById('preview-content');

        document.getElementById('file-upload-area').style.display = 'none';
        preview.classList.remove('hidden');

        previewContent.innerHTML = `
          <img src="${news.imagen}" alt="Preview" class="max-w-full h-48 object-cover rounded-lg mx-auto">
          <p class="mt-2 text-sm text-gray-600 font-medium">${news.imagenNombre}</p>
        `;
      }

      editingId = id;
      document.getElementById('submit-news').innerHTML = 'üîÑ Actualizar Noticia';
      document.getElementById('cancel-edit').classList.remove('hidden');

      newsForm.scrollIntoView({ behavior: 'smooth' });
    }

    // Cancelar edici√≥n
    function cancelEdit() {
      editingId = null;
      document.getElementById('submit-news').innerHTML = '‚ú® Publicar Noticia';
      document.getElementById('cancel-edit').classList.add('hidden');
      removeFile();
    }

    // Eliminar noticia
    function deleteNews(id) {
      if (confirm('¬øEst√°s seguro de eliminar esta noticia?')) {
        newsData = newsData.filter(n => n.id !== id);
        saveData();
        syncWithWebsite();
        loadNews();
        showNotification('üóëÔ∏è Noticia eliminada correctamente', 'success');
      }
    }

    // Filtrar noticias
    function filterNews() {
      const query = document.getElementById('search-news').value.toLowerCase();
      const filteredNews = newsData.filter(news => 
        news.titulo.toLowerCase().includes(query) || 
        news.resumen.toLowerCase().includes(query) ||
        news.categoria.toLowerCase().includes(query)
      );
      
      if (filteredNews.length === 0 && query) {
        newsList.innerHTML = `
          <div class="text-center py-16">
            <div class="text-gray-400 text-6xl mb-4">üîç</div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">No se encontraron noticias</h3>
          </div>
        `;
      } else {
        const originalData = [...newsData];
        newsData = filteredNews;
        loadNews();
        newsData = originalData;
      }
    }

    // Exportar datos
    function exportData() {
      const dataStr = JSON.stringify(newsData, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `sochimt_noticias_${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      URL.revokeObjectURL(url);
      showNotification('üì§ Datos exportados correctamente', 'success');
    }

    // Guardar datos
    function saveData() {
      try {
        localStorage.setItem(CONFIG.storageKey, JSON.stringify(newsData));
        console.log('üíæ Datos guardados en localStorage');
      } catch (e) {
        console.error('Error guardando datos:', e);
        showNotification('‚ùå Error al guardar datos', 'error');
      }
    }

    // Sincronizar con el sitio web
    function syncWithWebsite() {
      try {
        // Preparar datos p√∫blicos (solo las noticias publicadas)
        const publicData = newsData
          .filter(news => news.estado === 'publicada')
          .slice(0, 6) // Limitar a 6 noticias m√°s recientes
          .map(news => ({
            id: news.id,
            titulo: news.titulo,
            fecha: news.fecha,
            fechaRaw: news.fechaRaw,
            resumen: news.resumen,
            url: news.url,
            categoria: news.categoria,
            imagen: news.imagen,
            imagenTipo: news.imagenTipo,
            imagenNombre: news.imagenNombre,
            autor: news.autor,
            fechaCreacion: news.fechaCreacion
          }));

        // Guardar en localStorage para que el sitio web pueda leerlo
        localStorage.setItem(CONFIG.publicKey, JSON.stringify(publicData));
        
        // Guardar timestamp de √∫ltima sincronizaci√≥n
        localStorage.setItem('sochimt_last_sync', Date.now().toString());
        
        console.log(`üîÑ ${publicData.length} noticias sincronizadas con el sitio web`);
        
        // Actualizar UI
        showSyncBadge('‚úÖ Sincronizado', 'success');
        updateDebugPanel();
        
      } catch (e) {
        console.error('Error sincronizando:', e);
        showSyncBadge('‚ùå Error al sincronizar', 'error');
      }
    }

    // Forzar sincronizaci√≥n manual
    function forceSyncWithWebsite() {
      const btn = document.getElementById('fab-sync');
      btn.classList.add('syncing');
      
      showSyncBadge('üîÑ Sincronizando...', 'info');
      
      setTimeout(() => {
        syncWithWebsite();
        btn.classList.remove('syncing');
      }, 1000);
    }

    // Sincronizaci√≥n autom√°tica
    function autoSync() {
      if (newsData.length > 0) {
        syncWithWebsite();
      }
    }

    // Mostrar badge de sincronizaci√≥n
    function showSyncBadge(message, type = 'info') {
      const badge = document.getElementById('sync-badge');
      const messageEl = document.getElementById('sync-message');
      
      badge.className = `sync-badge show ${type === 'error' ? 'error' : ''}`;
      messageEl.textContent = message;
      
      setTimeout(() => {
        badge.classList.remove('show');
      }, 3000);
    }

    // Mostrar notificaciones
    function showNotification(message, type = 'info') {
      const notification = document.getElementById('notification');
      const colors = {
        success: 'bg-gradient-to-r from-green-500 to-green-600 text-white',
        error: 'bg-gradient-to-r from-red-500 to-red-600 text-white',
        info: 'bg-gradient-to-r from-blue-500 to-blue-600 text-white'
      };

      notification.className = `fixed top-4 right-4 p-4 sm:p-6 rounded-2xl shadow-2xl z-50 transform transition-all duration-300 ${colors[type]}`;
      notification.innerHTML = `
        <div class="flex items-center space-x-3">
          <div class="text-xl">${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</div>
          <div class="font-bold text-sm sm:text-base">${message}</div>
        </div>
      `;
      notification.classList.remove('hidden');

      setTimeout(() => {
        notification.classList.add('hidden');
      }, 4000);
    }

    // Debug panel
    function toggleDebugPanel() {
      const panel = document.getElementById('debug-panel');
      panel.classList.toggle('show');
      if (panel.classList.contains('show')) {
        updateDebugPanel();
      }
    }

    function updateDebugPanel() {
      const content = document.getElementById('debug-content');
      const publicData = JSON.parse(localStorage.getItem(CONFIG.publicKey) || '[]');
      const lastSync = localStorage.getItem('sochimt_last_sync');
      
      content.innerHTML = `
        <p><strong>Noticias totales:</strong> ${newsData.length}</p>
        <p><strong>Noticias p√∫blicas:</strong> ${publicData.length}</p>
        <p><strong>√öltima sync:</strong> ${lastSync ? new Date(parseInt(lastSync)).toLocaleTimeString() : 'Nunca'}</p>
        <p><strong>Usuario:</strong> ${currentUser || 'No logueado'}</p>
        <p><strong>Storage usado:</strong> ${(JSON.stringify(newsData).length / 1024).toFixed(2)} KB</p>
      `;
    }

    // Funci√≥n global de debug
    window.debugSOCHIMT = function() {
      console.log('üîç Debug SOCHIMT Panel:');
      console.log('- Noticias totales:', newsData.length);
      console.log('- Datos privados:', localStorage.getItem(CONFIG.storageKey));
      console.log('- Datos p√∫blicos:', localStorage.getItem(CONFIG.publicKey));
      console.log('- √öltima sync:', localStorage.getItem('sochimt_last_sync'));
      return {
        newsCount: newsData.length,
        publicData: JSON.parse(localStorage.getItem(CONFIG.publicKey) || '[]'),
        lastSync: localStorage.getItem('sochimt_last_sync')
      };
    };

    console.log('üöÄ Panel SOCHIMT v3.0 - Mobile Optimized');
    console.log('üì± Debug: Ctrl+Shift+D o ejecuta debugSOCHIMT()');
  </script>
</body>
</html>
