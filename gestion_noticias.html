<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel de Administraci√≥n - SOCHIMT</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'sochimt': {
              50: '#eff6ff',
              100: '#dbeafe', 
              200: '#bfdbfe',
              300: '#93c5fd',
              400: '#60a5fa',
              500: '#3b82f6',
              600: '#2563eb',
              700: '#1d4ed8',
              800: '#1e40af',
              900: '#1e3a8a',
            },
            'medical': {
              50: '#fef2f2',
              100: '#fee2e2',
              200: '#fecaca', 
              300: '#fca5a5',
              400: '#f87171',
              500: '#ef4444',
              600: '#dc2626',
              700: '#b91c1c',
              800: '#991b1b',
              900: '#7f1d1d',
            }
          },
          animation: {
            'slide-in': 'slideIn 0.3s ease-out',
            'fade-in': 'fadeIn 0.5s ease-out',
            'bounce-in': 'bounceIn 0.6s ease-out',
            'glow': 'glow 2s ease-in-out infinite alternate',
            'pulse-success': 'pulseSuccess 1s ease-in-out',
          }
        }
      }
    }
  </script>
  <style>
    @keyframes slideIn {
      from { transform: translateX(-100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes bounceIn {
      0% { transform: scale(0.3); opacity: 0; }
      50% { transform: scale(1.05); }
      70% { transform: scale(0.9); }
      100% { transform: scale(1); opacity: 1; }
    }
    @keyframes glow {
      from { box-shadow: 0 0 20px rgba(37, 99, 235, 0.3); }
      to { box-shadow: 0 0 30px rgba(37, 99, 235, 0.6); }
    }
    @keyframes pulseSuccess {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .gradient-mesh {
      background: linear-gradient(-45deg, #1e40af, #3b82f6, #dc2626, #ef4444);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .glass-morphism {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .card-hover {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .card-hover:hover {
      transform: translateY(-4px) scale(1.01);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    /* Indicadores de sincronizaci√≥n */
    .sync-indicator {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(37, 99, 235, 0.9);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
      backdrop-filter: blur(10px);
    }
    
    .sync-indicator.show {
      opacity: 1;
    }

    .sync-indicator.success {
      background: rgba(34, 197, 94, 0.9);
    }

    .sync-indicator.error {
      background: rgba(239, 68, 68, 0.9);
    }

    /* Bot√≥n de actualizaci√≥n manual */
    .manual-sync-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
      cursor: pointer;
      z-index: 1000;
      transition: all 0.3s ease;
    }

    .manual-sync-btn:hover {
      background: #1d4ed8;
      transform: scale(1.1);
    }

    .manual-sync-btn.syncing {
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-blue-50 min-h-screen">

  <!-- Login Screen -->
  <div id="login-screen" class="min-h-screen flex items-center justify-center p-4">
    <div class="bg-white/80 backdrop-blur-lg p-8 rounded-3xl shadow-2xl max-w-md w-full border border-white/20">
      <div class="text-center mb-8 animate-bounce-in">
        <div class="h-24 w-24 gradient-mesh rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg animate-glow">
          <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
          </svg>
        </div>
        <h1 class="text-3xl font-black text-gray-800 mb-2">Panel Administrativo</h1>
        <p class="text-gray-600 font-medium">SOCHIMT - Gesti√≥n de Contenido</p>
        <div class="w-20 h-1 bg-gradient-to-r from-sochimt-600 to-medical-600 rounded-full mx-auto mt-4"></div>
      </div>

      <form id="login-form" class="space-y-6">
        <div class="relative">
          <label for="username" class="block text-sm font-bold text-gray-700 mb-2">üë§ Usuario</label>
          <input type="text" id="username" required 
                 class="w-full px-6 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-sochimt-200 focus:border-sochimt-500 transition-all duration-300 bg-white/50 backdrop-blur-sm">
        </div>
        <div class="relative">
          <label for="password" class="block text-sm font-bold text-gray-700 mb-2">üîê Contrase√±a</label>
          <input type="password" id="password" required 
                 class="w-full px-6 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-sochimt-200 focus:border-sochimt-500 transition-all duration-300 bg-white/50 backdrop-blur-sm">
        </div>
        <button type="submit" id="login-btn" 
                class="w-full bg-gradient-to-r from-sochimt-600 to-sochimt-700 text-white py-4 px-6 rounded-xl hover:from-sochimt-700 hover:to-sochimt-800 transition-all duration-300 font-bold text-lg shadow-lg hover:shadow-xl transform hover:scale-105">
          ‚ú® Acceder al Panel
        </button>
      </form>

      <div id="login-error" class="hidden mt-6 p-4 bg-red-100 border-l-4 border-red-500 text-red-700 rounded-lg animate-fade-in">
        <div class="flex items-center">
          <span class="text-xl mr-2">‚ö†Ô∏è</span>
          <span>Usuario o contrase√±a incorrectos</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Admin Panel -->
  <div id="admin-panel" class="hidden min-h-screen">
    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-lg shadow-lg border-b border-white/20 sticky top-0 z-50">
      <div class="max-w-7xl mx-auto px-6 py-4">
        <div class="flex justify-between items-center">
          <div class="flex items-center space-x-4">
            <div class="h-12 w-12 gradient-mesh rounded-xl flex items-center justify-center shadow-lg">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9.5a2.5 2.5 0 00-2.5-2.5H15"/>
              </svg>
            </div>
            <div>
              <h1 class="text-2xl font-black text-gray-800">Panel de Administraci√≥n</h1>
              <p class="text-sm text-gray-600 font-medium">Gesti√≥n de Noticias SOCHIMT</p>
            </div>
          </div>
          <div class="flex items-center space-x-6">
            <!-- Indicador de sincronizaci√≥n -->
            <div id="sync-status" class="flex items-center space-x-2">
              <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
              <span class="text-sm text-gray-600">Sincronizado</span>
            </div>
            <div class="text-right">
              <span class="text-sm text-gray-600">Bienvenido,</span>
              <span id="current-user" class="font-bold text-sochimt-600"></span>
            </div>
            <button id="logout-btn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-all duration-300 transform hover:scale-105">
              üö™ Salir
            </button>
          </div>
        </div>
      </div>
    </header>

    <div class="max-w-7xl mx-auto px-6 py-8">
      <!-- Navigation Tabs -->
      <div class="mb-8">
        <div class="border-b border-gray-200">
          <nav class="-mb-px flex space-x-8">
            <button class="tab-btn active border-b-2 border-sochimt-600 text-sochimt-600 py-2 px-1 font-medium text-sm" data-tab="dashboard">
              üìä Dashboard
            </button>
            <button class="tab-btn border-b-2 border-transparent text-gray-500 hover:text-gray-700 py-2 px-1 font-medium text-sm" data-tab="noticias">
              üì∞ Gestionar Noticias
            </button>
            <button class="tab-btn border-b-2 border-transparent text-gray-500 hover:text-gray-700 py-2 px-1 font-medium text-sm" data-tab="configuracion">
              ‚öôÔ∏è Configuraci√≥n
            </button>
          </nav>
        </div>
      </div>

      <!-- Dashboard Tab -->
      <div id="tab-dashboard" class="tab-content">
        <!-- Dashboard Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-6 rounded-2xl text-white card-hover animate-fade-in">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-blue-100 font-medium">Total Noticias</p>
                <p class="text-3xl font-black" id="total-news">0</p>
              </div>
              <div class="text-4xl opacity-80">üì∞</div>
            </div>
          </div>
          <div class="bg-gradient-to-br from-green-500 to-green-600 p-6 rounded-2xl text-white card-hover animate-fade-in" style="animation-delay: 0.1s;">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-green-100 font-medium">Este Mes</p>
                <p class="text-3xl font-black" id="recent-news">0</p>
              </div>
              <div class="text-4xl opacity-80">üìÖ</div>
            </div>
          </div>
          <div class="bg-gradient-to-br from-purple-500 to-purple-600 p-6 rounded-2xl text-white card-hover animate-fade-in" style="animation-delay: 0.2s;">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-purple-100 font-medium">Categor√≠as</p>
                <p class="text-3xl font-black" id="categories-count">0</p>
              </div>
              <div class="text-4xl opacity-80">üè∑Ô∏è</div>
            </div>
          </div>
          <div class="bg-gradient-to-br from-orange-500 to-orange-600 p-6 rounded-2xl text-white card-hover animate-fade-in" style="animation-delay: 0.3s;">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-orange-100 font-medium">Publicadas</p>
                <p class="text-3xl font-black" id="published-news">0</p>
              </div>
              <div class="text-4xl opacity-80">‚úÖ</div>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="bg-white/80 backdrop-blur-lg rounded-3xl shadow-xl p-8 border border-white/20 animate-fade-in">
          <h2 class="text-2xl font-black text-gray-800 mb-6">üöÄ Acciones R√°pidas</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <button onclick="switchTab('noticias')" class="p-6 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl border-2 border-blue-200 hover:border-blue-300 transition-all duration-300 text-left card-hover">
              <div class="text-3xl mb-3">üìù</div>
              <h3 class="font-bold text-gray-800 mb-2">Nueva Noticia</h3>
              <p class="text-sm text-gray-600">Agregar una nueva noticia al sitio</p>
            </button>
            <button onclick="forceSyncWithWebsite()" class="p-6 bg-gradient-to-br from-green-50 to-green-100 rounded-xl border-2 border-green-200 hover:border-green-300 transition-all duration-300 text-left card-hover">
              <div class="text-3xl mb-3">üîÑ</div>
              <h3 class="font-bold text-gray-800 mb-2">Sincronizar Web</h3>
              <p class="text-sm text-gray-600">Actualizar sitio web manualmente</p>
            </button>
            <button onclick="exportData()" class="p-6 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl border-2 border-purple-200 hover:border-purple-300 transition-all duration-300 text-left card-hover">
              <div class="text-3xl mb-3">üì§</div>
              <h3 class="font-bold text-gray-800 mb-2">Exportar Datos</h3>
              <p class="text-sm text-gray-600">Descargar backup de noticias</p>
            </button>
          </div>

          <!-- Estado de sincronizaci√≥n -->
          <div class="mt-8 p-6 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl border border-blue-200">
            <h3 class="text-lg font-bold text-gray-800 mb-4">üì° Estado de Sincronizaci√≥n</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="text-center">
                <div class="text-2xl font-bold text-blue-600" id="last-sync-time">--:--</div>
                <div class="text-sm text-gray-600">√öltima sincronizaci√≥n</div>
              </div>
              <div class="text-center">
                <div class="text-2xl font-bold text-green-600" id="published-count">0</div>
                <div class="text-sm text-gray-600">Noticias en web</div>
              </div>
              <div class="text-center">
                <div class="text-2xl font-bold text-purple-600" id="pending-sync">0</div>
                <div class="text-sm text-gray-600">Pendientes de sync</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- News Management Tab -->
      <div id="tab-noticias" class="tab-content hidden">
        <!-- Add News Form -->
        <div class="bg-white/80 backdrop-blur-lg rounded-3xl shadow-xl p-8 mb-8 border border-white/20 animate-fade-in">
          <div class="flex items-center space-x-3 mb-8">
            <div class="h-12 w-12 bg-gradient-to-br from-sochimt-600 to-sochimt-700 rounded-xl flex items-center justify-center">
              <span class="text-white text-xl">‚ûï</span>
            </div>
            <h2 class="text-2xl font-black text-gray-800">Agregar Nueva Noticia</h2>
          </div>
          
          <form id="news-form" class="space-y-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <div>
                <label for="news-title" class="block text-sm font-bold text-gray-700 mb-3">üìù T√≠tulo *</label>
                <input type="text" id="news-title" required 
                       class="w-full px-6 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-sochimt-200 focus:border-sochimt-500 transition-all duration-300"
                       placeholder="Ingresa el t√≠tulo de la noticia...">
              </div>
              <div>
                <label for="news-category" class="block text-sm font-bold text-gray-700 mb-3">üè∑Ô∏è Categor√≠a *</label>
                <select id="news-category" required 
                        class="w-full px-6 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-sochimt-200 focus:border-sochimt-500 transition-all duration-300">
                  <option value="">Seleccionar categor√≠a</option>
                  <option value="Evento">üéâ Evento</option>
                  <option value="Publicaci√≥n">üìö Publicaci√≥n</option>
                  <option value="Webinar">üíª Webinar</option>
                  <option value="Congreso">üèõÔ∏è Congreso</option>
                  <option value="Noticia">üì∞ Noticia General</option>
                </select>
              </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <div>
                <label for="news-date" class="block text-sm font-bold text-gray-700 mb-3">üìÖ Fecha *</label>
                <input type="date" id="news-date" required 
                       class="w-full px-6 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-sochimt-200 focus:border-sochimt-500 transition-all duration-300">
              </div>
              <div>
                <label for="news-url" class="block text-sm font-bold text-gray-700 mb-3">üîó URL (opcional)</label>
                <input type="url" id="news-url" placeholder="https://..." 
                       class="w-full px-6 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-sochimt-200 focus:border-sochimt-500 transition-all duration-300">
              </div>
            </div>
            
            <!-- SECCI√ìN DE CARGA DE ARCHIVOS -->
            <div>
              <label for="news-image" class="block text-sm font-bold text-gray-700 mb-3">üñºÔ∏è Imagen o Video (opcional)</label>
              <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-sochimt-500 transition-all duration-300">
                <input type="file" id="news-image" accept="image/*,video/*" 
                       class="hidden" onchange="handleFileUpload(this)">
                <div id="file-upload-area" onclick="document.getElementById('news-image').click()" class="cursor-pointer">
                  <div class="text-4xl mb-4">üìé</div>
                  <p class="text-gray-600 font-medium mb-2">Haz clic para seleccionar archivo</p>
                  <p class="text-sm text-gray-500">Im√°genes: JPG, PNG, GIF | Videos: MP4, WebM (M√°x. 10MB)</p>
                </div>
                <div id="file-preview" class="hidden mt-4">
                  <div id="preview-content"></div>
                  <button type="button" onclick="removeFile()" class="mt-3 px-4 py-2 bg-red-500 text-white rounded-lg text-sm hover:bg-red-600 transition-colors">
                    üóëÔ∏è Eliminar archivo
                  </button>
                </div>
              </div>
            </div>
            
            <div>
              <label for="news-summary" class="block text-sm font-bold text-gray-700 mb-3">üìÑ Resumen *</label>
              <textarea id="news-summary" rows="4" required 
                        class="w-full px-6 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-sochimt-200 focus:border-sochimt-500 transition-all duration-300 resize-none"
                        placeholder="Describe brevemente la noticia..."></textarea>
            </div>
            
            <div class="flex justify-end space-x-4">
              <button type="button" id="cancel-edit" class="hidden px-8 py-3 border-2 border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-all duration-300 font-medium">
                ‚ùå Cancelar
              </button>
              <button type="submit" id="submit-news" 
                      class="px-8 py-3 bg-gradient-to-r from-sochimt-600 to-sochimt-700 text-white rounded-xl hover:from-sochimt-700 hover:to-sochimt-800 transition-all duration-300 font-bold shadow-lg hover:shadow-xl transform hover:scale-105">
                ‚ú® Publicar Noticia
              </button>
            </div>
          </form>
        </div>

        <!-- News List -->
        <div class="bg-white/80 backdrop-blur-lg rounded-3xl shadow-xl p-8 border border-white/20 animate-fade-in">
          <div class="flex justify-between items-center mb-8">
            <div class="flex items-center space-x-3">
              <div class="h-12 w-12 bg-gradient-to-br from-purple-600 to-purple-700 rounded-xl flex items-center justify-center">
                <span class="text-white text-xl">üìã</span>
              </div>
              <h2 class="text-2xl font-black text-gray-800">Noticias Publicadas</h2>
            </div>
            <div class="flex items-center space-x-4">
              <div class="relative">
                <input type="text" id="search-news" placeholder="üîç Buscar noticias..." 
                       class="px-6 py-3 pl-12 border-2 border-gray-200 rounded-xl text-sm focus:ring-4 focus:ring-sochimt-200 focus:border-sochimt-500 transition-all duration-300 w-80">
                <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                  üîç
                </div>
              </div>
              <button id="export-data" class="px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-xl hover:from-green-700 hover:to-green-800 text-sm font-bold transition-all duration-300 transform hover:scale-105">
                üì§ Exportar
              </button>
            </div>
          </div>

          <div id="news-list" class="space-y-4">
            <!-- News items will be loaded here -->
          </div>

          <div id="no-news" class="hidden text-center py-16">
            <div class="text-gray-400 text-8xl mb-6">üì∞</div>
            <h3 class="text-2xl font-bold text-gray-900 mb-4">No hay noticias publicadas</h3>
            <p class="text-gray-500 text-lg">Agrega tu primera noticia usando el formulario de arriba.</p>
          </div>
        </div>
      </div>

      <!-- Configuration Tab -->
      <div id="tab-configuracion" class="tab-content hidden">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          
          <!-- Change Password Section -->
          <div class="bg-white/80 backdrop-blur-lg rounded-3xl shadow-xl p-8 border border-white/20 animate-fade-in">
            <div class="flex items-center space-x-3 mb-8">
              <div class="h-12 w-12 bg-gradient-to-br from-medical-600 to-medical-700 rounded-xl flex items-center justify-center">
                <span class="text-white text-xl">üîê</span>
              </div>
              <h2 class="text-2xl font-black text-gray-800">Cambiar Contrase√±a</h2>
            </div>
            
            <form id="change-password-form" class="space-y-6">
              <div>
                <label for="current-password" class="block text-sm font-bold text-gray-700 mb-3">üîë Contrase√±a Actual *</label>
                <input type="password" id="current-password" required 
                       class="w-full px-6 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-medical-200 focus:border-medical-500 transition-all duration-300"
                       placeholder="Ingresa tu contrase√±a actual">
              </div>
              <div>
                <label for="new-password" class="block text-sm font-bold text-gray-700 mb-3">üÜï Nueva Contrase√±a *</label>
                <input type="password" id="new-password" required 
                       class="w-full px-6 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-medical-200 focus:border-medical-500 transition-all duration-300"
                       placeholder="M√≠nimo 6 caracteres">
                <div class="mt-2 text-xs text-gray-500">
                  <p>‚úì M√≠nimo 6 caracteres</p>
                  <p>‚úì Se recomienda usar n√∫meros y s√≠mbolos</p>
                </div>
              </div>
              <div>
                <label for="confirm-password" class="block text-sm font-bold text-gray-700 mb-3">‚úÖ Confirmar Contrase√±a *</label>
                <input type="password" id="confirm-password" required 
                       class="w-full px-6 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-medical-200 focus:border-medical-500 transition-all duration-300"
                       placeholder="Repite la nueva contrase√±a">
              </div>
              <button type="submit" 
                      class="w-full px-8 py-4 bg-gradient-to-r from-medical-600 to-medical-700 text-white rounded-xl hover:from-medical-700 hover:to-medical-800 transition-all duration-300 font-bold shadow-lg hover:shadow-xl transform hover:scale-105">
                üîÑ Actualizar Contrase√±a
              </button>
            </form>
          </div>

          <!-- User Management Section -->
          <div class="bg-white/80 backdrop-blur-lg rounded-3xl shadow-xl p-8 border border-white/20 animate-fade-in">
            <div class="flex items-center space-x-3 mb-8">
              <div class="h-12 w-12 bg-gradient-to-br from-sochimt-600 to-sochimt-700 rounded-xl flex items-center justify-center">
                <span class="text-white text-xl">üë•</span>
              </div>
              <h2 class="text-2xl font-black text-gray-800">Gesti√≥n de Usuarios</h2>
            </div>
            
            <div id="users-list" class="space-y-4">
              <!-- Users will be loaded here -->
            </div>

            <!-- Statistics -->
            <div class="mt-8 pt-6 border-t border-gray-200">
              <h3 class="text-lg font-bold text-gray-800 mb-4">üìä Estad√≠sticas del Sistema</h3>
              <div class="grid grid-cols-2 gap-4">
                <div class="bg-blue-50 p-4 rounded-xl">
                  <div class="text-2xl font-bold text-sochimt-600" id="total-news-stat">0</div>
                  <div class="text-sm text-gray-600">Total de noticias</div>
                </div>
                <div class="bg-green-50 p-4 rounded-xl">
                  <div class="text-2xl font-bold text-green-600" id="recent-news-stat">0</div>
                  <div class="text-sm text-gray-600">Este mes</div>
                </div>
                <div class="bg-purple-50 p-4 rounded-xl">
                  <div class="text-2xl font-bold text-purple-600" id="categories-count-stat">0</div>
                  <div class="text-sm text-gray-600">Categor√≠as activas</div>
                </div>
                <div class="bg-orange-50 p-4 rounded-xl">
                  <div class="text-2xl font-bold text-orange-600" id="users-count-stat">0</div>
                  <div class="text-sm text-gray-600">Usuarios activos</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Success/Error Notifications -->
  <div id="notification" class="fixed top-4 right-4 p-6 rounded-2xl shadow-2xl hidden z-50 transform transition-all duration-300"></div>

  <!-- Sync Indicator -->
  <div id="sync-indicator" class="sync-indicator">
    <span id="sync-message">Sincronizando...</span>
  </div>

  <!-- Manual Sync Button -->
  <button id="manual-sync-btn" class="manual-sync-btn" onclick="forceSyncWithWebsite()" title="Sincronizar con el sitio web">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
    </svg>
  </button>

  <script>
    // Configuraci√≥n mejorada
    const CONFIG = {
      users: {
        'admin': 'marcelo',
        'editora': 'silvia',
        'gestor': 'marcelo'
      },
      storageKey: 'sochimt_news_data',
      sessionKey: 'sochimt_session',
      usersKey: 'sochimt_users_data',
      // Configuraci√≥n de sincronizaci√≥n
      sync: {
        publicKey: 'sochimt_public_news',
        timestampKey: 'sochimt_last_sync',
        versionKey: 'sochimt_data_version',
        broadcastChannel: 'sochimt_updates'
      }
    };

    // Variables globales de sincronizaci√≥n
    let broadcastChannel = null;
    let syncInterval = null;
    let lastSyncTime = null;
    let dataVersion = 1;

    // Cargar usuarios desde localStorage o usar por defecto
    function loadUsers() {
      const savedUsers = localStorage.getItem(CONFIG.usersKey);
      if (savedUsers) {
        CONFIG.users = JSON.parse(savedUsers);
      } else {
        saveUsers();
      }
    }

    // Guardar usuarios en localStorage
    function saveUsers() {
      localStorage.setItem(CONFIG.usersKey, JSON.stringify(CONFIG.users));
    }

    // Estado global
    let currentUser = null;
    let editingId = null;
    let newsData = JSON.parse(localStorage.getItem(CONFIG.storageKey)) || [];

    // Variables globales para archivos
    let selectedFile = null;
    let selectedFileData = null;

    // Inicializar sistema de sincronizaci√≥n
    function initSyncSystem() {
      // Crear canal de broadcast para comunicaci√≥n entre pesta√±as
      if (typeof BroadcastChannel !== 'undefined') {
        broadcastChannel = new BroadcastChannel(CONFIG.sync.broadcastChannel);
        console.log('üì° Sistema de comunicaci√≥n entre pesta√±as iniciado');
      }

      // Recuperar timestamp de √∫ltima sincronizaci√≥n
      lastSyncTime = localStorage.getItem(CONFIG.sync.timestampKey);
      
      // Recuperar versi√≥n de datos
      const savedVersion = localStorage.getItem(CONFIG.sync.versionKey);
      if (savedVersion) {
        dataVersion = parseInt(savedVersion);
      }

      // Configurar sincronizaci√≥n autom√°tica cada 30 segundos
      syncInterval = setInterval(() => {
        autoSyncWithWebsite();
      }, 30000);

      // Escuchar eventos de storage para sincronizaci√≥n entre pesta√±as
      window.addEventListener('storage', handleStorageChange);

      console.log('üîÑ Sistema de sincronizaci√≥n iniciado');
      updateSyncStatus();
    }

    // Manejar cambios en localStorage
    function handleStorageChange(e) {
      if (e.key === CONFIG.sync.publicKey || e.key === CONFIG.storageKey) {
        console.log('üì° Detectado cambio en datos, actualizando...');
        updateSyncStatus();
      }
    }

    // Sincronizaci√≥n autom√°tica silenciosa
    function autoSyncWithWebsite() {
      if (newsData.length > 0) {
        generateWebData(true); // true para sincronizaci√≥n silenciosa
      }
    }

    // Forzar sincronizaci√≥n manual
    function forceSyncWithWebsite() {
      const btn = document.getElementById('manual-sync-btn');
      const indicator = document.getElementById('sync-indicator');
      
      btn.classList.add('syncing');
      showSyncIndicator('üîÑ Sincronizando con el sitio web...', 'info');
      
      setTimeout(() => {
        generateWebData(false); // false para mostrar notificaci√≥n
        btn.classList.remove('syncing');
        showSyncIndicator('‚úÖ Sitio web actualizado correctamente', 'success');
        
        // Enviar evento a otras pesta√±as
        if (broadcastChannel) {
          broadcastChannel.postMessage({
            type: 'news_updated',
            timestamp: Date.now(),
            user: currentUser
          });
        }
        
        setTimeout(() => {
          hideSyncIndicator();
        }, 2000);
      }, 1500);
    }

    // Mostrar indicador de sincronizaci√≥n
    function showSyncIndicator(message, type = 'info') {
      const indicator = document.getElementById('sync-indicator');
      const messageEl = document.getElementById('sync-message');
      
      indicator.className = `sync-indicator show ${type}`;
      messageEl.textContent = message;
    }

    // Ocultar indicador de sincronizaci√≥n
    function hideSyncIndicator() {
      const indicator = document.getElementById('sync-indicator');
      indicator.classList.remove('show');
    }

    // Actualizar estado de sincronizaci√≥n en dashboard
    function updateSyncStatus() {
      const lastSyncEl = document.getElementById('last-sync-time');
      const publishedCountEl = document.getElementById('published-count');
      const pendingSyncEl = document.getElementById('pending-sync');
      const syncStatus = document.getElementById('sync-status');

      if (lastSyncTime) {
        const time = new Date(parseInt(lastSyncTime));
        lastSyncEl.textContent = time.toLocaleTimeString('es-CL', { 
          hour: '2-digit', 
          minute: '2-digit' 
        });
      }

      // Contar noticias publicadas en web
      const publicData = JSON.parse(localStorage.getItem(CONFIG.sync.publicKey) || '[]');
      publishedCountEl.textContent = publicData.length;

      // Calcular pendientes (siempre 0 por ahora ya que sincronizamos autom√°ticamente)
      pendingSyncEl.textContent = '0';

      // Actualizar indicador visual
      if (syncStatus) {
        const indicator = syncStatus.querySelector('.w-3');
        const text = syncStatus.querySelector('span');
        
        if (lastSyncTime && (Date.now() - parseInt(lastSyncTime)) < 60000) {
          indicator.className = 'w-3 h-3 bg-green-500 rounded-full animate-pulse';
          text.textContent = 'Sincronizado';
        } else {
          indicator.className = 'w-3 h-3 bg-yellow-500 rounded-full animate-pulse';
          text.textContent = 'Pendiente sync';
        }
      }
    }

    // Manejar carga de archivos
    function handleFileUpload(input) {
      const file = input.files[0];
      if (!file) return;

      // Validar tama√±o (10MB m√°ximo)
      const maxSize = 10 * 1024 * 1024; // 10MB
      if (file.size > maxSize) {
        showNotification('‚ùå El archivo es demasiado grande. M√°ximo 10MB permitido.', 'error');
        input.value = '';
        return;
      }

      // Validar tipo de archivo
      const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp', 'video/mp4', 'video/webm'];
      if (!validTypes.includes(file.type)) {
        showNotification('‚ùå Tipo de archivo no v√°lido. Solo se permiten im√°genes y videos.', 'error');
        input.value = '';
        return;
      }

      selectedFile = file;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        selectedFileData = e.target.result;
        showFilePreview(file, e.target.result);
      };
      reader.readAsDataURL(file);
    }

    // Mostrar preview del archivo
    function showFilePreview(file, dataUrl) {
      const uploadArea = document.getElementById('file-upload-area');
      const preview = document.getElementById('file-preview');
      const previewContent = document.getElementById('preview-content');

      uploadArea.style.display = 'none';
      preview.classList.remove('hidden');

      if (file.type.startsWith('image/')) {
        previewContent.innerHTML = `
          <img src="${dataUrl}" alt="Preview" class="max-w-full h-48 object-cover rounded-lg mx-auto">
          <p class="mt-2 text-sm text-gray-600 font-medium">${file.name}</p>
          <p class="text-xs text-gray-500">${(file.size / 1024 / 1024).toFixed(2)} MB</p>
        `;
      } else if (file.type.startsWith('video/')) {
        previewContent.innerHTML = `
          <video controls class="max-w-full h-48 rounded-lg mx-auto">
            <source src="${dataUrl}" type="${file.type}">
          </video>
          <p class="mt-2 text-sm text-gray-600 font-medium">${file.name}</p>
          <p class="text-xs text-gray-500">${(file.size / 1024 / 1024).toFixed(2)} MB</p>
        `;
      }
    }

    // Eliminar archivo seleccionado
    function removeFile() {
      selectedFile = null;
      selectedFileData = null;
      document.getElementById('news-image').value = '';
      document.getElementById('file-upload-area').style.display = 'block';
      document.getElementById('file-preview').classList.add('hidden');
    }

    // Elementos DOM
    const loginScreen = document.getElementById('login-screen');
    const adminPanel = document.getElementById('admin-panel');
    const loginForm = document.getElementById('login-form');
    const newsForm = document.getElementById('news-form');
    const newsList = document.getElementById('news-list');
    const noNews = document.getElementById('no-news');

    // Inicializaci√≥n
    document.addEventListener('DOMContentLoaded', () => {
      loadUsers();
      checkSession();
      setupEventListeners();
      updateStats();
      setDefaultDate();
      initSyncSystem();
    });

    // Establecer fecha por defecto
    function setDefaultDate() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('news-date').value = today;
    }

    // Verificar sesi√≥n existente
    function checkSession() {
      const session = sessionStorage.getItem(CONFIG.sessionKey);
      if (session) {
        currentUser = session;
        showAdminPanel();
      }
    }

    // Configurar event listeners
    function setupEventListeners() {
      loginForm.addEventListener('submit', handleLogin);
      document.getElementById('logout-btn').addEventListener('click', logout);
      newsForm.addEventListener('submit', handleNewsSubmit);
      document.getElementById('cancel-edit').addEventListener('click', cancelEdit);
      document.getElementById('search-news').addEventListener('input', filterNews);
      document.getElementById('export-data').addEventListener('click', exportData);
      document.getElementById('change-password-form').addEventListener('submit', handlePasswordChange);

      // Tab navigation
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => switchTab(btn.dataset.tab));
      });
    }

    // Cambiar tabs
    function switchTab(tabName) {
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active', 'border-sochimt-600', 'text-sochimt-600');
        btn.classList.add('border-transparent', 'text-gray-500');
      });
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
      });

      document.querySelector(`[data-tab="${tabName}"]`).classList.add('active', 'border-sochimt-600', 'text-sochimt-600');
      document.querySelector(`[data-tab="${tabName}"]`).classList.remove('border-transparent', 'text-gray-500');
      document.getElementById(`tab-${tabName}`).classList.remove('hidden');

      if (tabName === 'configuracion') {
        loadUsersList();
      } else if (tabName === 'dashboard') {
        updateSyncStatus();
      }
    }

    // Manejo de login
    function handleLogin(e) {
      e.preventDefault();
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      if (CONFIG.users[username] && CONFIG.users[username] === password) {
        currentUser = username;
        sessionStorage.setItem(CONFIG.sessionKey, username);
        showAdminPanel();
        showNotification('¬°Bienvenido al panel de administraci√≥n! üéâ', 'success');
      } else {
        document.getElementById('login-error').classList.remove('hidden');
        setTimeout(() => {
          document.getElementById('login-error').classList.add('hidden');
        }, 5000);
      }
    }

    // Mostrar panel de administraci√≥n
    function showAdminPanel() {
      loginScreen.classList.add('hidden');
      adminPanel.classList.remove('hidden');
      document.getElementById('current-user').textContent = currentUser;
      loadNews();
      updateStats();
      updateSyncStatus();
    }

    // Logout
    function logout() {
      // Limpiar sincronizaci√≥n
      if (syncInterval) {
        clearInterval(syncInterval);
      }
      if (broadcastChannel) {
        broadcastChannel.close();
      }
      
      sessionStorage.removeItem(CONFIG.sessionKey);
      currentUser = null;
      adminPanel.classList.add('hidden');
      loginScreen.classList.remove('hidden');
      loginForm.reset();
      showNotification('Sesi√≥n cerrada correctamente üëã', 'info');
    }

    // Cambio de contrase√±a
    function handlePasswordChange(e) {
      e.preventDefault();
      const currentPassword = document.getElementById('current-password').value;
      const newPassword = document.getElementById('new-password').value;
      const confirmPassword = document.getElementById('confirm-password').value;

      // Validaciones
      if (CONFIG.users[currentUser] !== currentPassword) {
        showNotification('‚ùå La contrase√±a actual es incorrecta', 'error');
        return;
      }

      if (newPassword.length < 6) {
        showNotification('‚ùå La nueva contrase√±a debe tener al menos 6 caracteres', 'error');
        return;
      }

      if (newPassword !== confirmPassword) {
        showNotification('‚ùå Las contrase√±as no coinciden', 'error');
        return;
      }

      if (newPassword === currentPassword) {
        showNotification('‚ùå La nueva contrase√±a debe ser diferente a la actual', 'error');
        return;
      }

      // Actualizar contrase√±a
      CONFIG.users[currentUser] = newPassword;
      saveUsers();
      
      // Limpiar formulario
      document.getElementById('change-password-form').reset();
      
      showNotification('‚úÖ Contrase√±a actualizada exitosamente', 'success');
    }

    // Cargar lista de usuarios
    function loadUsersList() {
      const usersContainer = document.getElementById('users-list');
      usersContainer.innerHTML = Object.keys(CONFIG.users).map(username => `
        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
          <div class="flex items-center space-x-3">
            <div class="w-10 h-10 bg-gradient-to-br from-sochimt-600 to-sochimt-700 rounded-full flex items-center justify-center">
              <span class="text-white font-bold text-sm">${username.charAt(0).toUpperCase()}</span>
            </div>
            <div>
              <p class="font-bold text-gray-800">${username}</p>
              <p class="text-sm text-gray-600">${username === currentUser ? 'Sesi√≥n actual' : 'Usuario activo'}</p>
            </div>
          </div>
          <div class="flex items-center space-x-2">
            <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-bold">
              ${username === currentUser ? 'üü¢ Actual' : '‚úÖ Activo'}
            </span>
          </div>
        </div>
      `).join('');
    }

    // Manejo de formulario de noticias
    function handleNewsSubmit(e) {
      e.preventDefault();
      
      const formData = {
        id: editingId || Date.now().toString(),
        titulo: document.getElementById('news-title').value,
        categoria: document.getElementById('news-category').value,
        fecha: formatDate(document.getElementById('news-date').value),
        fechaRaw: document.getElementById('news-date').value,
        resumen: document.getElementById('news-summary').value,
        url: document.getElementById('news-url').value || '#',
        imagen: selectedFileData || getImageForCategory(document.getElementById('news-category').value),
        imagenNombre: selectedFile ? selectedFile.name : null,
        imagenTipo: selectedFile ? selectedFile.type : null,
        autor: currentUser,
        fechaCreacion: editingId ? newsData.find(n => n.id === editingId).fechaCreacion : new Date().toISOString(),
        estado: 'publicada'
      };

      if (editingId) {
        const index = newsData.findIndex(n => n.id === editingId);
        // Mantener imagen anterior si no se subi√≥ una nueva
        if (!selectedFileData) {
          const oldNews = newsData[index];
          formData.imagen = oldNews.imagen;
          formData.imagenNombre = oldNews.imagenNombre;
          formData.imagenTipo = oldNews.imagenTipo;
        }
        newsData[index] = formData;
        showNotification('‚úÖ Noticia actualizada correctamente', 'success');
      } else {
        newsData.unshift(formData);
        showNotification('üéâ ¬°Noticia publicada exitosamente!', 'success');
      }

      // Incrementar versi√≥n de datos
      dataVersion++;
      localStorage.setItem(CONFIG.sync.versionKey, dataVersion.toString());

      saveData();
      loadNews();
      newsForm.reset();
      setDefaultDate();
      cancelEdit();
      updateStats();
      
      // Sincronizar inmediatamente
      generateWebData(false);
      
      // Forzar actualizaci√≥n en todas las pesta√±as abiertas
      if (broadcastChannel) {
        broadcastChannel.postMessage({
          type: 'news_updated',
          timestamp: Date.now(),
          user: currentUser,
          action: editingId ? 'updated' : 'created',
          newsId: formData.id
        });
      }
    }

    // Obtener imagen seg√∫n categor√≠a
    function getImageForCategory(category) {
      const images = {
        'Evento': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDQwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjM0I4MkY2Ii8+Cjx0ZXh0IHg9IjIwMCIgeT0iMTAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSIyNCIgZm9udC1mYW1pbHk9IkludGVyLCBzYW5zLXNlcmlmIj7wn44pIEV2ZW50bzwvdGV4dD4KPC9zdmc+',
        'Publicaci√≥n': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDQwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjREMyNjI2Ii8+Cjx0ZXh0IHg9IjIwMCIgeT0iMTAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSIyMCIgZm9udC1mYW1pbHk9IkludGVyLCBzYW5zLXNlcmlmIj7wn5OaIFB1YmxpY2FjacOzbjwvdGV4dD4KPC9zdmc+',
        'Webinar': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDQwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjMDU5NjY5Ii8+Cjx0ZXh0IHg9IjIwMCIgeT0iMTAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSIyMiIgZm9udC1mYW1pbHk9IkludGVyLCBzYW5zLXNlcmlmIj7wn5KrIFdlYmluYXI8L3RleHQ+Cjwvc3ZnPg==',
        'Congreso': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDQwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjN0MzQUVEIi8+Cjx0ZXh0IHg9IjIwMCIgeT0iMTAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSIyMCIgZm9udC1mYW1pbHk9IkludGVyLCBzYW5zLXNlcmlmIj7wn48bIENvbmdyZXNvPC90ZXh0Pgo8L3N2Zz4=',
        'Noticia': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDQwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjU5RTBCIi8+Cjx0ZXh0IHg9IjIwMCIgeT0iMTAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSIyMiIgZm9udC1mYW1pbHk9IkludGVyLCBzYW5zLXNlcmlmIj7wn5OYIE5vdGljaWE8L3RleHQ+Cjwvc3ZnPg=='
      };
      return images[category] || images['Noticia'];
    }

    // Formatear fecha
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      const options = { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric'
      };
      return date.toLocaleDateString('es-CL', options);
    }

    // Cargar noticias
    function loadNews() {
      if (newsData.length === 0) {
        newsList.innerHTML = '';
        noNews.classList.remove('hidden');
        return;
      }

      noNews.classList.add('hidden');
      newsList.innerHTML = newsData.map(news => `
        <div class="bg-white/60 backdrop-blur-sm border-2 border-gray-100 rounded-2xl p-6 hover:shadow-xl transition-all duration-300 card-hover">
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <div class="flex items-center space-x-3 mb-4">
                <span class="px-4 py-2 bg-gradient-to-r from-sochimt-600 to-sochimt-700 text-white rounded-full text-sm font-bold">
                  ${news.categoria}
                </span>
                <span class="text-sm text-gray-600 font-medium">üìÖ ${news.fecha}</span>
                <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-bold">‚úÖ Publicada</span>
                ${news.imagenNombre ? '<span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-bold">üìé Con archivo</span>' : ''}
              </div>
              ${news.imagen && news.imagenNombre && news.imagen.startsWith('data:') ? 
                `<div class="mb-4">
                  ${news.imagenTipo && news.imagenTipo.startsWith('image/') ? 
                    `<img src="${news.imagen}" alt="${news.titulo}" class="w-full h-32 object-cover rounded-lg">` :
                    news.imagenTipo && news.imagenTipo.startsWith('video/') ?
                    `<video controls class="w-full h-32 rounded-lg">
                      <source src="${news.imagen}" type="${news.imagenTipo}">
                    </video>` : ''
                  }
                </div>` : ''
              }
              <h3 class="text-xl font-bold text-gray-800 mb-3 hover:text-sochimt-600 transition-colors">${news.titulo}</h3>
              <p class="text-gray-600 leading-relaxed mb-4">${news.resumen}</p>
              ${news.url && news.url !== '#' ? 
                `<div class="mb-4">
                  <a href="${news.url}" target="_blank" rel="noopener noreferrer" 
                     class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-sochimt-600 to-sochimt-700 text-white rounded-lg hover:from-sochimt-700 hover:to-sochimt-800 transition-all duration-300 text-sm font-bold shadow-lg hover:shadow-xl transform hover:scale-105">
                    üìñ Leer m√°s
                    <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                    </svg>
                  </a>
                </div>` : ''
              }
              <div class="flex items-center text-xs text-gray-500 space-x-6">
                <span class="flex items-center space-x-1">
                  <span>üë§</span>
                  <span>Por: ${news.autor}</span>
                </span>
                <span class="flex items-center space-x-1">
                  <span>üïí</span>
                  <span>Creado: ${new Date(news.fechaCreacion).toLocaleDateString('es-CL')}</span>
                </span>
              </div>
            </div>
            <div class="flex items-center space-x-3 ml-6">
              <button onclick="editNews('${news.id}')" 
                      class="p-3 text-blue-600 hover:bg-blue-50 rounded-xl transition-all duration-300 transform hover:scale-110" 
                      title="Editar noticia">
                ‚úèÔ∏è
              </button>
              <button onclick="deleteNews('${news.id}')" 
                      class="p-3 text-red-600 hover:bg-red-50 rounded-xl transition-all duration-300 transform hover:scale-110" 
                      title="Eliminar noticia">
                üóëÔ∏è
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Editar noticia
    function editNews(id) {
      const news = newsData.find(n => n.id === id);
      if (!news) return;

      // Cambiar a la pesta√±a de noticias
      switchTab('noticias');

      document.getElementById('news-title').value = news.titulo;
      document.getElementById('news-category').value = news.categoria;
      document.getElementById('news-date').value = news.fechaRaw;
      document.getElementById('news-summary').value = news.resumen;
      document.getElementById('news-url').value = news.url === '#' ? '' : news.url;

      // Manejar imagen existente
      if (news.imagen && news.imagenNombre && news.imagen.startsWith('data:')) {
        selectedFileData = news.imagen;
        const uploadArea = document.getElementById('file-upload-area');
        const preview = document.getElementById('file-preview');
        const previewContent = document.getElementById('preview-content');

        uploadArea.style.display = 'none';
        preview.classList.remove('hidden');

        if (news.imagenTipo && news.imagenTipo.startsWith('image/')) {
          previewContent.innerHTML = `
            <img src="${news.imagen}" alt="Preview" class="max-w-full h-48 object-cover rounded-lg mx-auto">
            <p class="mt-2 text-sm text-gray-600 font-medium">${news.imagenNombre}</p>
            <p class="text-xs text-gray-500">Archivo existente</p>
          `;
        } else if (news.imagenTipo && news.imagenTipo.startsWith('video/')) {
          previewContent.innerHTML = `
            <video controls class="max-w-full h-48 rounded-lg mx-auto">
              <source src="${news.imagen}" type="${news.imagenTipo}">
            </video>
            <p class="mt-2 text-sm text-gray-600 font-medium">${news.imagenNombre}</p>
            <p class="text-xs text-gray-500">Archivo existente</p>
          `;
        }
      }

      editingId = id;
      document.getElementById('submit-news').innerHTML = 'üîÑ Actualizar Noticia';
      document.getElementById('cancel-edit').classList.remove('hidden');

      newsForm.scrollIntoView({ behavior: 'smooth' });
      showNotification('üìù Modo edici√≥n activado', 'info');
    }

    // Cancelar edici√≥n
    function cancelEdit() {
      editingId = null;
      document.getElementById('submit-news').innerHTML = '‚ú® Publicar Noticia';
      document.getElementById('cancel-edit').classList.add('hidden');
      removeFile(); // Limpiar archivo seleccionado
    }

    // Eliminar noticia
    function deleteNews(id) {
      if (confirm('üóëÔ∏è ¬øEst√°s seguro de que quieres eliminar esta noticia?')) {
        newsData = newsData.filter(n => n.id !== id);
        
        // Incrementar versi√≥n
        dataVersion++;
        localStorage.setItem(CONFIG.sync.versionKey, dataVersion.toString());
        
        saveData();
        loadNews();
        updateStats();
        generateWebData(false);
        
        // Notificar a otras pesta√±as
        if (broadcastChannel) {
          broadcastChannel.postMessage({
            type: 'news_deleted',
            timestamp: Date.now(),
            user: currentUser,
            newsId: id
          });
        }
        
        showNotification('üóëÔ∏è Noticia eliminada correctamente', 'success');
      }
    }

    // Filtrar noticias
    function filterNews() {
      const query = document.getElementById('search-news').value.toLowerCase();
      const filteredNews = newsData.filter(news => 
        news.titulo.toLowerCase().includes(query) || 
        news.resumen.toLowerCase().includes(query) ||
        news.categoria.toLowerCase().includes(query)
      );
      
      if (filteredNews.length === 0 && query) {
        newsList.innerHTML = `
          <div class="text-center py-16">
            <div class="text-gray-400 text-6xl mb-4">üîç</div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">No se encontraron noticias</h3>
            <p class="text-gray-500">No hay noticias que coincidan con tu b√∫squeda.</p>
          </div>
        `;
      } else {
        const originalData = [...newsData];
        newsData = filteredNews;
        loadNews();
        newsData = originalData;
      }
    }

    // Exportar datos
    function exportData() {
      const dataStr = JSON.stringify(newsData, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `sochimt_noticias_${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      URL.revokeObjectURL(url);
      showNotification('üì§ Datos exportados correctamente', 'success');
    }

    // Actualizar estad√≠sticas
    function updateStats() {
      const now = new Date();
      const thisMonth = newsData.filter(news => {
        const newsDate = new Date(news.fechaCreacion);
        return newsDate.getMonth() === now.getMonth() && 
               newsDate.getFullYear() === now.getFullYear();
      }).length;

      const categories = [...new Set(newsData.map(news => news.categoria))].length;
      const published = newsData.filter(news => news.estado === 'publicada').length;
      const usersCount = Object.keys(CONFIG.users).length;

      // Dashboard stats
      document.getElementById('total-news').textContent = newsData.length;
      document.getElementById('recent-news').textContent = thisMonth;
      document.getElementById('categories-count').textContent = categories;
      document.getElementById('published-news').textContent = published;

      // Configuration stats
      document.getElementById('total-news-stat').textContent = newsData.length;
      document.getElementById('recent-news-stat').textContent = thisMonth;
      document.getElementById('categories-count-stat').textContent = categories;
      document.getElementById('users-count-stat').textContent = usersCount;
    }

    // Guardar datos
    function saveData() {
      localStorage.setItem(CONFIG.storageKey, JSON.stringify(newsData));
    }

    // Generar datos para la web p√∫blica (MEJORADO)
    function generateWebData(silent = false) {
      const publicData = newsData
        .filter(news => news.estado === 'publicada')
        .slice(0, 6) // Aumentar a 6 noticias para mejor variedad
        .map(news => ({
          id: news.id,
          titulo: news.titulo,
          fecha: news.fecha,
          fechaRaw: news.fechaRaw,
          resumen: news.resumen,
          url: news.url,
          categoria: news.categoria,
          imagen: news.imagen || getImageForCategory(news.categoria),
          imagenTipo: news.imagenTipo || null,
          imagenNombre: news.imagenNombre || null,
          autor: news.autor,
          fechaCreacion: news.fechaCreacion,
          version: dataVersion
        }));

      // Guardar con timestamp y versi√≥n
      const publicDataWithMeta = {
        noticias: publicData,
        lastUpdate: Date.now(),
        version: dataVersion,
        generatedBy: currentUser
      };

      try {
        // Guardar datos principales
        localStorage.setItem(CONFIG.sync.publicKey, JSON.stringify(publicData));
        
        // Guardar metadata de sincronizaci√≥n
        localStorage.setItem(CONFIG.sync.timestampKey, Date.now().toString());
        localStorage.setItem(CONFIG.sync.versionKey, dataVersion.toString());
        
        // Guardar datos completos para debug
        localStorage.setItem('sochimt_sync_meta', JSON.stringify(publicDataWithMeta));

        // Intentar notificar al sitio web principal
        try {
          // Usar Custom Event para notificar cambios
          const event = new CustomEvent('sochimt_data_updated', {
            detail: {
              noticias: publicData,
              timestamp: Date.now(),
              version: dataVersion
            }
          });
          window.dispatchEvent(event);

          // Tambi√©n usar storage event para cross-tab communication
          window.dispatchEvent(new StorageEvent('storage', {
            key: CONFIG.sync.publicKey,
            newValue: JSON.stringify(publicData),
            url: window.location.href
          }));

        } catch (eventError) {
          console.warn('No se pudo enviar evento de actualizaci√≥n:', eventError);
        }

        lastSyncTime = Date.now();
        
        if (!silent) {
          console.log('üåê Datos p√∫blicos actualizados:');
          console.log(`üìä ${publicData.length} noticias sincronizadas`);
          console.log(`üïí Timestamp: ${new Date(lastSyncTime).toLocaleString('es-CL')}`);
          console.log(`üìù Versi√≥n: ${dataVersion}`);
          
          showNotification('üåê Sitio web actualizado correctamente', 'success');
        }

        updateSyncStatus();

      } catch (error) {
        console.error('Error sincronizando datos:', error);
        if (!silent) {
          showNotification('‚ùå Error al sincronizar con el sitio web', 'error');
        }
      }
    }

    // Mostrar notificaciones
    function showNotification(message, type = 'info') {
      const notification = document.getElementById('notification');
      const colors = {
        success: 'bg-gradient-to-r from-green-500 to-green-600 text-white',
        error: 'bg-gradient-to-r from-red-500 to-red-600 text-white',
        info: 'bg-gradient-to-r from-blue-500 to-blue-600 text-white'
      };

      notification.className = `fixed top-4 right-4 p-6 rounded-2xl shadow-2xl z-50 transform transition-all duration-300 ${colors[type]}`;
      notification.innerHTML = `
        <div class="flex items-center space-x-3">
          <div class="text-2xl">${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</div>
          <div class="font-bold">${message}</div>
        </div>
      `;
      notification.classList.remove('hidden');
      notification.style.transform = 'translateX(0)';

      setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
          notification.classList.add('hidden');
        }, 300);
      }, 4000);
    }

    // Funci√≥n de debug global
    window.debugSyncSystem = function() {
      console.log('üîç Debug Sistema de Sincronizaci√≥n:');
      console.log('- Canal broadcast:', !!broadcastChannel);
      console.log('- √öltima sincronizaci√≥n:', lastSyncTime ? new Date(parseInt(lastSyncTime)).toLocaleString('es-CL') : 'Nunca');
      console.log('- Versi√≥n de datos:', dataVersion);
      console.log('- Total noticias:', newsData.length);
      
      const publicData = JSON.parse(localStorage.getItem(CONFIG.sync.publicKey) || '[]');
      console.log('- Noticias p√∫blicas:', publicData.length);
      
      const syncMeta = JSON.parse(localStorage.getItem('sochimt_sync_meta') || '{}');
      console.log('- Metadata de sync:', syncMeta);
      
      return {
        lastSync: lastSyncTime,
        version: dataVersion,
        totalNews: newsData.length,
        publicNews: publicData.length,
        hasBroadcastChannel: !!broadcastChannel
      };
    };

    // Generar datos iniciales al cargar
    generateWebData(true);
    
    console.log('üöÄ Panel de administraci√≥n SOCHIMT v2.0 cargado');
    console.log('üì± Comandos de debug disponibles: debugSyncSystem()');
  </script>
</body>
</html>
