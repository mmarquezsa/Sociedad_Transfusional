<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>√Årea de Socios - SOCHIMT</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- EmailJS SDK -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'sochimt': { 50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd', 400: '#60a5fa', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 800: '#1e40af', 900: '#1e3a8a' },
            'medical': { 50: '#fef2f2', 100: '#fee2e2', 200: '#fecaca', 300: '#fca5a5', 400: '#f87171', 500: '#ef4444', 600: '#dc2626', 700: '#b91c1c', 800: '#991b1b', 900: '#7f1d1d' }
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
    
    body { 
      font-family: 'Inter', sans-serif;
      scroll-behavior: smooth;
    }
    
    .gradient-mesh {
      background: linear-gradient(-45deg, #1e40af, #3b82f6, #dc2626, #ef4444);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
    }
    
    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(5deg); }
    }
    
    @keyframes fadeInUp {
      from { 
        opacity: 0; 
        transform: translateY(30px); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0); 
      }
    }
    
    @keyframes pulse-glow {
      0%, 100% {
        box-shadow: 0 0 20px rgba(37, 99, 235, 0.4);
      }
      50% {
        box-shadow: 0 0 30px rgba(37, 99, 235, 0.6);
      }
    }
    
    .float-animation {
      animation: float 4s ease-in-out infinite;
    }
    
    .fade-in-up {
      animation: fadeInUp 0.8s ease-out;
    }
    
    .pulse-glow {
      animation: pulse-glow 2s ease-in-out infinite;
    }
    
    .text-gradient {
      background: linear-gradient(135deg, #2563eb 0%, #dc2626 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.8);
    }
    
    .input-focus:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    
    /* Scroll suave */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #f1f5f9; }
    ::-webkit-scrollbar-thumb { background: #2563eb; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #1d4ed8; }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-50 via-blue-50 to-red-50 min-h-screen antialiased">
  
  <!-- Header -->
  <header class="absolute top-0 left-0 right-0 z-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
      <div class="flex items-center justify-between">
        <a href="index.html" class="flex items-center space-x-3">
          <div class="w-12 h-12 bg-white rounded-xl flex items-center justify-center shadow-lg p-1.5">
            <img src="images/logos/_ Main Logo 1.3.png" alt="SOCHIMT Logo" class="w-full h-full object-contain">
          </div>
          <div class="hidden sm:block">
            <h1 class="text-xl font-bold text-gray-900">SOCHIMT</h1>
            <p class="text-xs text-gray-600">Sociedad Chilena de Medicina Transfusional</p>
          </div>
        </a>
        <a href="index.html" class="text-gray-600 hover:text-sochimt-600 font-medium text-sm flex items-center">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
          </svg>
          Volver al inicio
        </a>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="min-h-screen flex items-center justify-center px-4 py-20">
    <div class="max-w-6xl w-full grid md:grid-cols-2 gap-8 items-center">
      
      <!-- Left Side - Branding -->
      <div class="hidden md:block">
        <div class="text-center space-y-6">
          <div class="inline-block">
            <div class="w-32 h-32 bg-white rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-2xl float-animation p-6">
              <img src="images/logos/_ Main Logo 1.3.png" alt="SOCHIMT Logo" class="w-full h-full object-contain">
            </div>
          </div>
          
          <h2 class="text-4xl lg:text-5xl font-black text-gray-900">
            Bienvenido al
            <span class="text-gradient block mt-2">√Årea de Socios</span>
          </h2>
          
          <p class="text-xl text-gray-600 max-w-md mx-auto">
            Accede a contenido exclusivo, eventos y herramientas profesionales
          </p>

          <!-- Beneficios -->
          <div class="bg-white/80 backdrop-blur-sm rounded-2xl p-6 shadow-xl max-w-md mx-auto">
            <h3 class="font-bold text-gray-900 mb-4 text-lg">Beneficios Exclusivos</h3>
            <ul class="space-y-3 text-left">
              <li class="flex items-center text-sm">
                <div class="w-8 h-8 bg-gradient-to-br from-sochimt-500 to-sochimt-600 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                  <span class="text-lg">üíß</span>
                </div>
                <span class="text-gray-700"><strong>IA Gotita</strong> - Consultas especializadas ilimitadas</span>
              </li>
              <li class="flex items-center text-sm">
                <div class="w-8 h-8 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                  <span class="text-lg">üìö</span>
                </div>
                <span class="text-gray-700"><strong>Blog Premium</strong> - Art√≠culos y casos cl√≠nicos completos</span>
              </li>
              <li class="flex items-center text-sm">
                <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                  <span class="text-lg">üéüÔ∏è</span>
                </div>
                <span class="text-gray-700"><strong>Eventos</strong> - Inscripci√≥n prioritaria con descuentos</span>
              </li>
              <li class="flex items-center text-sm">
                <div class="w-8 h-8 bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                  <span class="text-lg">üì•</span>
                </div>
                <span class="text-gray-700"><strong>Recursos</strong> - Biblioteca de gu√≠as y protocolos</span>
              </li>
              <li class="flex items-center text-sm">
                <div class="w-8 h-8 bg-gradient-to-br from-red-500 to-red-600 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                  <span class="text-lg">üéì</span>
                </div>
                <span class="text-gray-700"><strong>Certificaciones</strong> - Validaci√≥n y tracking de cr√©ditos</span>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Right Side - Login Form -->
      <div class="glass-card rounded-3xl shadow-2xl p-8 md:p-12 fade-in-up">
        
        <!-- Mobile Branding -->
        <div class="md:hidden text-center mb-8">
          <div class="w-20 h-20 bg-white rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg pulse-glow p-3">
            <img src="images/logos/_ Main Logo 1.3.png" alt="SOCHIMT Logo" class="w-full h-full object-contain">
          </div>
          <h1 class="text-3xl font-black text-gray-900">√Årea de Socios</h1>
          <p class="text-gray-600 mt-2 font-medium">SOCHIMT</p>
        </div>

        <!-- Form Header -->
        <div class="mb-10">
          <h2 class="text-3xl md:text-4xl font-black text-gray-900 mb-2">Bienvenido de vuelta</h2>
          <p class="text-gray-600 text-lg">Ingresa con tu cuenta de socio</p>
        </div>

        <!-- Login Form -->
        <form id="login-form" class="space-y-6">
          
          <div class="group">
            <label for="email" class="block text-sm font-bold text-gray-700 mb-3 flex items-center space-x-2">
              <svg class="w-5 h-5 text-sochimt-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
              </svg>
              <span>Correo Electr√≥nico</span>
            </label>
            <input 
              type="email" 
              id="email" 
              required 
              class="w-full px-5 py-4 border-2 border-gray-200 rounded-xl input-focus focus:outline-none transition-all text-base"
              placeholder="ejemplo@email.com"
              autocomplete="email"
            >
          </div>

          <div class="group">
            <label for="password" class="block text-sm font-bold text-gray-700 mb-3 flex items-center space-x-2">
              <svg class="w-5 h-5 text-sochimt-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
              </svg>
              <span>Contrase√±a</span>
            </label>
            <input 
              type="password" 
              id="password" 
              required 
              class="w-full px-5 py-4 border-2 border-gray-200 rounded-xl input-focus focus:outline-none transition-all text-base"
              placeholder="Ingresa tu contrase√±a"
              autocomplete="current-password"
            >
          </div>

          <div class="flex items-center justify-between pt-2">
            <label class="flex items-center group cursor-pointer">
              <input type="checkbox" id="remember-me" class="w-5 h-5 text-sochimt-600 border-gray-300 rounded focus:ring-2 focus:ring-sochimt-500 transition-all cursor-pointer">
              <span class="ml-3 text-sm font-medium text-gray-700 group-hover:text-gray-900 transition-colors">Recordarme</span>
            </label>
            <a href="#" id="forgot-password-link" class="text-sm text-sochimt-600 hover:text-sochimt-700 font-bold hover:underline transition-all">
              ¬øOlvidaste tu contrase√±a?
            </a>
          </div>

          <!-- Error Message -->
          <div id="error-message" class="hidden p-5 bg-red-50 border-l-4 border-red-500 rounded-xl">
            <div class="flex items-start">
              <svg class="w-6 h-6 text-red-500 mr-3 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
              </svg>
              <div>
                <h4 class="font-bold text-red-800 mb-1">Error de inicio de sesi√≥n</h4>
                <span id="error-text" class="text-sm text-red-700"></span>
              </div>
            </div>
          </div>

          <!-- Submit Button -->
          <button 
            type="submit" 
            id="login-btn"
            class="w-full bg-gradient-to-r from-sochimt-600 to-medical-600 text-white py-5 rounded-xl font-black text-lg hover:from-sochimt-700 hover:to-medical-700 transition-all duration-300 shadow-xl hover:shadow-2xl transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center space-x-3 mt-8"
          >
            <span id="login-btn-text" class="flex items-center space-x-3">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/>
              </svg>
              <span>Iniciar Sesi√≥n</span>
            </span>
            <span id="login-btn-loading" class="hidden flex items-center space-x-3">
              <svg class="animate-spin h-6 w-6" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              <span>Ingresando...</span>
            </span>
          </button>

          <!-- Divider -->
          <div class="relative my-8">
            <div class="absolute inset-0 flex items-center">
              <div class="w-full border-t-2 border-gray-200"></div>
            </div>
            <div class="relative flex justify-center text-base">
              <span class="px-6 glass-card text-gray-600 font-semibold rounded-full py-1">¬øNo eres socio a√∫n?</span>
            </div>
          </div>

          <!-- Register Link -->
          <div class="text-center">
            <a href="registro-socios.html" class="inline-flex items-center space-x-3 px-8 py-4 border-2 border-sochimt-600 text-sochimt-600 hover:bg-sochimt-600 hover:text-white font-bold text-base rounded-xl transition-all duration-300 shadow-md hover:shadow-xl transform hover:scale-105 group">
              <svg class="w-6 h-6 group-hover:rotate-12 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
              </svg>
              <span>Solicitar Membres√≠a</span>
            </a>
          </div>

        </form>

        <!-- Help Section -->
        <div class="mt-10 pt-8 border-t-2 border-gray-100">
          <p class="text-center text-base text-gray-600">
            ¬øProblemas para acceder? 
            <a href="mailto:soporte@sochimt.cl" class="text-sochimt-600 hover:text-sochimt-700 font-bold hover:underline transition-all">
              Cont√°ctanos aqu√≠
            </a>
          </p>
        </div>
      </div>

    </div>
  </div>

  <!-- Footer -->
  <footer class="py-8 text-center">
    <div class="max-w-7xl mx-auto px-4">
      <p class="text-gray-600 font-medium">
        &copy; 2025 <span class="font-bold text-sochimt-600">SOCHIMT</span> - Sociedad Chilena de Medicina Transfusional
      </p>
      <p class="text-sm text-gray-500 mt-2">Todos los derechos reservados</p>
    </div>
  </footer>

  <!-- Modal Recuperaci√≥n de Contrase√±a -->
  <div id="modal-recuperacion" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center px-4">
    <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-8 transform transition-all">
      <!-- Header -->
      <div class="text-center mb-6">
        <div class="w-16 h-16 bg-gradient-to-br from-sochimt-100 to-medical-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
          <svg class="w-8 h-8 text-sochimt-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
          </svg>
        </div>
        <h3 class="text-2xl font-black text-gray-900">¬øOlvidaste tu contrase√±a?</h3>
        <p class="text-gray-600 mt-2 text-sm">Ingresa tu correo electr√≥nico y te enviaremos instrucciones para recuperarla</p>
      </div>

      <!-- Form -->
      <form id="form-recuperacion" class="space-y-5">
        <div>
          <label for="email-recuperacion" class="block text-sm font-bold text-gray-700 mb-2">
            üìß Correo Electr√≥nico
          </label>
          <input
            type="email"
            id="email-recuperacion"
            required
            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-sochimt-500 focus:outline-none transition-all"
            placeholder="tucorreo@ejemplo.com"
          >
        </div>

        <!-- Success Message -->
        <div id="success-recuperacion" class="hidden p-4 bg-green-50 border-l-4 border-green-500 rounded-xl">
          <div class="flex items-start">
            <svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            <p class="text-sm text-green-700 font-medium">
              ¬°Email enviado! Revisa tu bandeja de entrada
            </p>
          </div>
        </div>

        <!-- Error Message -->
        <div id="error-recuperacion" class="hidden p-4 bg-red-50 border-l-4 border-red-500 rounded-xl">
          <div class="flex items-start">
            <svg class="w-5 h-5 text-red-500 mr-2 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
            </svg>
            <div>
              <p class="text-sm text-red-700 font-medium" id="error-text-recuperacion"></p>
            </div>
          </div>
        </div>

        <!-- Buttons -->
        <div class="flex space-x-3 pt-4">
          <button
            type="button"
            id="btn-cancelar-recuperacion"
            class="flex-1 px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold rounded-xl transition-all"
          >
            Cancelar
          </button>
          <button
            type="submit"
            id="btn-enviar-recuperacion"
            class="flex-1 px-6 py-3 bg-gradient-to-r from-sochimt-600 to-medical-600 text-white font-bold rounded-xl hover:from-sochimt-700 hover:to-medical-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
          >
            <span id="text-enviar-recuperacion">Enviar</span>
            <span id="loading-enviar-recuperacion" class="hidden flex items-center">
              <svg class="animate-spin h-5 w-5" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Supabase Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- Auth Script -->
  <script src="js/auth.js"></script>
  
  <script>
    // Login Form Handler
    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const rememberMe = document.getElementById('remember-me').checked;
      
      const loginBtn = document.getElementById('login-btn');
      const loginBtnText = document.getElementById('login-btn-text');
      const loginBtnLoading = document.getElementById('login-btn-loading');
      const errorMessage = document.getElementById('error-message');
      
      // Disable button and show loading
      loginBtn.disabled = true;
      loginBtnText.classList.add('hidden');
      loginBtnLoading.classList.remove('hidden');
      errorMessage.classList.add('hidden');
      
      try {
        await loginSocio(email, password, rememberMe);
      } catch (error) {
        // Show error
        document.getElementById('error-text').textContent = error.message;
        errorMessage.classList.remove('hidden');
        
        // Re-enable button
        loginBtn.disabled = false;
        loginBtnText.classList.remove('hidden');
        loginBtnLoading.classList.add('hidden');
      }
    });

    // Inicializar EmailJS
    emailjs.init('geeQcpwrcKHulwQef');

    // Modal Recuperaci√≥n de Contrase√±a
    const modal = document.getElementById('modal-recuperacion');
    const forgotLink = document.getElementById('forgot-password-link');
    const btnCancelar = document.getElementById('btn-cancelar-recuperacion');
    const formRecuperacion = document.getElementById('form-recuperacion');
    const successMsg = document.getElementById('success-recuperacion');
    const errorMsg = document.getElementById('error-recuperacion');

    // Abrir modal
    forgotLink.addEventListener('click', (e) => {
      e.preventDefault();
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      // Limpiar formulario
      formRecuperacion.reset();
      successMsg.classList.add('hidden');
      errorMsg.classList.add('hidden');
    });

    // Cerrar modal
    btnCancelar.addEventListener('click', () => {
      modal.classList.add('hidden');
      document.body.style.overflow = 'auto';
    });

    // Cerrar modal al hacer clic fuera
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.classList.add('hidden');
        document.body.style.overflow = 'auto';
      }
    });

    // Manejar env√≠o de recuperaci√≥n
    formRecuperacion.addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = document.getElementById('email-recuperacion').value;
      const btnEnviar = document.getElementById('btn-enviar-recuperacion');
      const textEnviar = document.getElementById('text-enviar-recuperacion');
      const loadingEnviar = document.getElementById('loading-enviar-recuperacion');

      // Ocultar mensajes
      successMsg.classList.add('hidden');
      errorMsg.classList.add('hidden');

      // Mostrar loading
      btnEnviar.disabled = true;
      textEnviar.classList.add('hidden');
      loadingEnviar.classList.remove('hidden');

      try {
        // Verificar si el email existe en Supabase
        const { data: supabaseConfig } = await fetch('js/config.js').then(r => r.text()).then(text => {
          const supabaseUrlMatch = text.match(/SUPABASE_URL\s*=\s*['"]([^'"]+)['"]/);
          const supabaseKeyMatch = text.match(/SUPABASE_KEY\s*=\s*['"]([^'"]+)['"]/);
          return {
            data: {
              url: supabaseUrlMatch ? supabaseUrlMatch[1] : null,
              key: supabaseKeyMatch ? supabaseKeyMatch[1] : null
            }
          };
        });

        console.log('üîê Solicitando recuperaci√≥n de contrase√±a para:', email);

        // Generar c√≥digo de recuperaci√≥n (6 d√≠gitos)
        const codigoRecuperacion = Math.floor(100000 + Math.random() * 900000).toString();
        const fechaExpiracion = new Date();
        fechaExpiracion.setHours(fechaExpiracion.getHours() + 1); // Expira en 1 hora

        // Enviar email con EmailJS
        const emailParams = {
          to_email: email,
          to_name: email.split('@')[0], // Usar primera parte del email como nombre
          codigo_recuperacion: codigoRecuperacion,
          fecha_expiracion: fechaExpiracion.toLocaleString('es-CL', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          }),
          link_recuperacion: `${window.location.origin}/login-socios.html#reset=${codigoRecuperacion}`
        };

        await emailjs.send('service_7uxenu4', 'template_recuperacion_password', emailParams);

        console.log('‚úÖ Email de recuperaci√≥n enviado exitosamente');

        // Mostrar mensaje de √©xito
        successMsg.classList.remove('hidden');

        // Limpiar formulario
        formRecuperacion.reset();

        // Cerrar modal despu√©s de 3 segundos
        setTimeout(() => {
          modal.classList.add('hidden');
          document.body.style.overflow = 'auto';
          successMsg.classList.add('hidden');
        }, 3000);

      } catch (error) {
        console.error('‚ùå Error al enviar email de recuperaci√≥n:', error);

        // Mostrar mensaje de error
        document.getElementById('error-text-recuperacion').textContent =
          'No se pudo enviar el email. Verifica que el correo est√© registrado.';
        errorMsg.classList.remove('hidden');
      } finally {
        // Restaurar bot√≥n
        btnEnviar.disabled = false;
        textEnviar.classList.remove('hidden');
        loadingEnviar.classList.add('hidden');
      }
    });
  </script>
</body>
</html>
