<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - √Årea de Socios SOCHIMT</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'sochimt': { 50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd', 400: '#60a5fa', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 800: '#1e40af', 900: '#1e3a8a' },
            'medical': { 50: '#fef2f2', 100: '#fee2e2', 200: '#fecaca', 300: '#fca5a5', 400: '#f87171', 500: '#ef4444', 600: '#dc2626', 700: '#b91c1c', 800: '#991b1b', 900: '#7f1d1d' }
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .gradient-mesh { background: linear-gradient(-45deg, #2563eb, #3b82f6, #dc2626, #ef4444); background-size: 400% 400%; animation: gradientShift 15s ease infinite; }
    @keyframes gradientShift { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
    @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
    .float-animation { animation: float 3s ease-in-out infinite; }
    .text-gradient { background: linear-gradient(135deg, #2563eb 0%, #dc2626 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .card-hover { transition: all 0.3s ease; }
    .card-hover:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
  </style>
</head>
<body class="bg-gradient-to-br from-sochimt-50 via-white to-medical-50 min-h-screen">
  
  <!-- Header/Navbar -->
  <header class="bg-white/90 backdrop-blur-lg shadow-lg border-b border-white/20 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-20">
        
        <!-- Logo -->
        <div class="flex items-center space-x-4">
          <div class="w-12 h-12 bg-white rounded-xl flex items-center justify-center shadow-lg p-1.5">
            <img src="images/logos/_ Main Logo 1.3.png" alt="SOCHIMT Logo" class="w-full h-full object-contain">
          </div>
          <div>
            <h1 class="text-xl font-black text-gray-900">SOCHIMT</h1>
            <p class="text-xs text-gray-600">√Årea de Socios</p>
          </div>
        </div>

        <!-- Navigation -->
        <nav class="hidden md:flex items-center space-x-6">
          <a href="index.html" class="text-gray-700 hover:text-sochimt-600 font-medium transition-colors">
            Inicio
          </a>
          <a href="#" class="text-gray-700 hover:text-sochimt-600 font-medium transition-colors">
            Eventos
          </a>
          <a href="#" class="text-gray-700 hover:text-sochimt-600 font-medium transition-colors">
            Art√≠culos
          </a>
          <a href="#" class="text-gray-700 hover:text-sochimt-600 font-medium transition-colors">
            Recursos
          </a>
        </nav>

        <!-- User Menu -->
        <div class="flex items-center space-x-4">
          <div class="text-right hidden sm:block">
            <p class="text-sm text-gray-600">Bienvenido/a,</p>
            <p id="user-name" class="text-sm font-bold text-sochimt-600">Cargando...</p>
          </div>
          <button onclick="logoutSocio()" class="bg-gradient-to-r from-medical-600 to-medical-700 hover:from-medical-700 hover:to-medical-800 text-white px-4 py-2 rounded-lg font-medium transition-all text-sm shadow-md hover:shadow-lg">
            üö™ Salir
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <!-- Welcome Banner -->
    <div class="bg-gradient-to-r from-sochimt-600 to-medical-600 rounded-3xl p-8 md:p-12 text-white shadow-2xl mb-8">
      <div class="flex flex-col md:flex-row items-center justify-between">
        <div class="mb-6 md:mb-0">
          <h2 class="text-3xl md:text-4xl font-black mb-3">
            ¬°Bienvenido/a de vuelta! üëã
          </h2>
          <p class="text-white/90 text-lg mb-4" id="welcome-message">Cargando...</p>
          <div class="flex items-center space-x-4">
            <span id="membership-status" class="px-4 py-2 bg-white/20 backdrop-blur-sm rounded-full text-sm font-bold">
              Estado: Cargando...
            </span>
            <span id="membership-expiry" class="text-sm text-white/80">
              <!-- Se llenar√° din√°micamente -->
            </span>
          </div>
        </div>
        <div class="float-animation">
          <div class="w-32 h-32 bg-white rounded-3xl flex items-center justify-center p-6 shadow-xl">
            <img src="images/logos/_ Main Logo 1.3.png" alt="SOCHIMT Logo" class="w-full h-full object-contain">
          </div>
        </div>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <!-- Stat 1 -->
      <div class="bg-gradient-to-br from-sochimt-500 to-sochimt-600 rounded-2xl p-6 text-white card-hover">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sochimt-100 font-medium text-sm">Consultas a Gotita</p>
            <p id="stat-gotita" class="text-4xl font-black mt-2">0</p>
          </div>
          <div class="text-5xl opacity-80">üí¨</div>
        </div>
      </div>

      <!-- Stat 2 -->
      <div class="bg-gradient-to-br from-medical-500 to-medical-600 rounded-2xl p-6 text-white card-hover">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-medical-100 font-medium text-sm">Eventos Inscritos</p>
            <p id="stat-eventos" class="text-4xl font-black mt-2">0</p>
          </div>
          <div class="text-5xl opacity-80">üìÖ</div>
        </div>
      </div>

      <!-- Stat 3 -->
      <div class="bg-gradient-to-br from-sochimt-600 to-sochimt-700 rounded-2xl p-6 text-white card-hover">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sochimt-100 font-medium text-sm">Art√≠culos Le√≠dos</p>
            <p id="stat-articulos" class="text-4xl font-black mt-2">0</p>
          </div>
          <div class="text-5xl opacity-80">üìö</div>
        </div>
      </div>

      <!-- Stat 4 -->
      <div class="bg-gradient-to-br from-medical-600 to-medical-700 rounded-2xl p-6 text-white card-hover">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-medical-100 font-medium text-sm">Certificaciones</p>
            <p id="stat-certificaciones" class="text-4xl font-black mt-2">0</p>
          </div>
          <div class="text-5xl opacity-80">üéì</div>
        </div>
      </div>
    </div>

    <!-- Panel de Administraci√≥n (solo visible para admin/supervisor) -->
    <div id="admin-panel" class="hidden bg-gradient-to-br from-yellow-50 to-orange-50 rounded-3xl shadow-2xl p-8 md:p-12 mb-8 border-2 border-yellow-300">
      <div class="flex items-center justify-between mb-8">
        <div class="flex items-center space-x-4">
          <div class="w-16 h-16 bg-gradient-to-br from-yellow-500 to-orange-600 rounded-2xl flex items-center justify-center shadow-lg">
            <span class="text-4xl">üëë</span>
          </div>
          <div>
            <h2 class="text-3xl md:text-4xl font-black text-gray-900">
              Panel de Administraci√≥n
            </h2>
            <p class="text-gray-600 font-medium" id="admin-role-badge">Administrador</p>
          </div>
        </div>
      </div>
      
      <div class="grid md:grid-cols-2 gap-6">
        
        <!-- Gesti√≥n de Art√≠culos -->
        <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-all cursor-pointer group" onclick="openContentManager('articulos')">
          <div class="flex items-start space-x-4">
            <div class="w-12 h-12 bg-gradient-to-br from-sochimt-500 to-sochimt-600 rounded-xl flex items-center justify-center flex-shrink-0 shadow-md">
              <span class="text-2xl">üìù</span>
            </div>
            <div class="flex-1">
              <h3 class="text-xl font-black text-gray-900 mb-2">Gestionar Art√≠culos</h3>
              <p class="text-gray-600 text-sm">Agregar, editar o eliminar art√≠culos del blog premium</p>
            </div>
            <svg class="w-6 h-6 text-gray-400 group-hover:text-sochimt-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </div>
        </div>

        <!-- Gesti√≥n de Eventos -->
        <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-all cursor-pointer group" onclick="openContentManager('eventos')">
          <div class="flex items-start space-x-4">
            <div class="w-12 h-12 bg-gradient-to-br from-medical-500 to-medical-600 rounded-xl flex items-center justify-center flex-shrink-0 shadow-md">
              <span class="text-2xl">üìÖ</span>
            </div>
            <div class="flex-1">
              <h3 class="text-xl font-black text-gray-900 mb-2">Gestionar Eventos</h3>
              <p class="text-gray-600 text-sm">Crear y administrar webinars, cursos y congresos</p>
            </div>
            <svg class="w-6 h-6 text-gray-400 group-hover:text-medical-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </div>
        </div>

        <!-- Gesti√≥n de Recursos -->
        <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-all cursor-pointer group" onclick="openContentManager('recursos')">
          <div class="flex items-start space-x-4">
            <div class="w-12 h-12 bg-gradient-to-br from-sochimt-600 to-sochimt-700 rounded-xl flex items-center justify-center flex-shrink-0 shadow-md">
              <span class="text-2xl">üì•</span>
            </div>
            <div class="flex-1">
              <h3 class="text-xl font-black text-gray-900 mb-2">Gestionar Recursos</h3>
              <p class="text-gray-600 text-sm">Subir gu√≠as, protocolos y documentos</p>
            </div>
            <svg class="w-6 h-6 text-gray-400 group-hover:text-sochimt-700 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </div>
        </div>

        <!-- Gesti√≥n de Socios -->
        <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-all cursor-pointer group" onclick="openContentManager('socios')">
          <div class="flex items-start space-x-4">
            <div class="w-12 h-12 bg-gradient-to-br from-medical-600 to-medical-700 rounded-xl flex items-center justify-center flex-shrink-0 shadow-md">
              <span class="text-2xl">üë•</span>
            </div>
            <div class="flex-1">
              <h3 class="text-xl font-black text-gray-900 mb-2">Gestionar Socios</h3>
              <p class="text-gray-600 text-sm">Aprobar, editar o desactivar membres√≠as</p>
            </div>
            <svg class="w-6 h-6 text-gray-400 group-hover:text-medical-700 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </div>
        </div>

      </div>
    </div>

    <!-- Herramientas Cl√≠nicas Destacadas -->
    <div class="bg-gradient-to-r from-indigo-600 to-purple-700 rounded-3xl p-6 md:p-8 mb-8 shadow-2xl">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
          <span class="text-3xl">ü©∫</span>
        </div>
        <div>
          <h2 class="text-2xl font-black text-white">Herramientas Cl√≠nicas</h2>
          <p class="text-indigo-100 text-sm">Calculadoras y recursos para tu pr√°ctica diaria</p>
        </div>
      </div>
      <div class="grid md:grid-cols-3 gap-4">
        <!-- Calculadora de Hemocomponentes -->
        <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-5 border border-white/20 hover:bg-white/20 transition-all cursor-pointer group" onclick="abrirCalculadora()">
          <div class="flex items-center gap-3 mb-3">
            <span class="text-3xl">üßÆ</span>
            <h3 class="text-lg font-bold text-white">Calculadora de Dosis</h3>
          </div>
          <p class="text-indigo-100 text-sm mb-3">Calcula dosis de GR, plaquetas, plasma y crioprecipitado seg√∫n peso del paciente.</p>
          <span class="text-yellow-300 text-xs font-bold flex items-center gap-1 group-hover:gap-2 transition-all">
            Usar herramienta <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
          </span>
        </div>
        
        <!-- Compatibilidad ABO/Rh -->
        <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-5 border border-white/20 hover:bg-white/20 transition-all cursor-pointer group" onclick="abrirCompatibilidad()">
          <div class="flex items-center gap-3 mb-3">
            <span class="text-3xl">ü©∏</span>
            <h3 class="text-lg font-bold text-white">Compatibilidad ABO/Rh</h3>
          </div>
          <p class="text-indigo-100 text-sm mb-3">Consulta r√°pida de compatibilidad entre grupos sangu√≠neos para transfusi√≥n.</p>
          <span class="text-yellow-300 text-xs font-bold flex items-center gap-1 group-hover:gap-2 transition-all">
            Ver tabla <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
          </span>
        </div>
        
        <!-- Criterios de Selecci√≥n -->
        <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-5 border border-white/20 hover:bg-white/20 transition-all cursor-pointer group" onclick="abrirCriterios()">
          <div class="flex items-center gap-3 mb-3">
            <span class="text-3xl">‚úÖ</span>
            <h3 class="text-lg font-bold text-white">Criterios de Selecci√≥n</h3>
          </div>
          <p class="text-indigo-100 text-sm mb-3">Gu√≠a r√°pida de criterios de elegibilidad para donantes de sangre.</p>
          <span class="text-yellow-300 text-xs font-bold flex items-center gap-1 group-hover:gap-2 transition-all">
            Consultar <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
          </span>
        </div>
      </div>
    </div>

    <!-- Quick Access Cards Grid -->
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
      
      <!-- Gotita Card - Destacada -->
      <div class="bg-gradient-to-br from-sochimt-50 to-blue-50 rounded-2xl shadow-xl p-8 card-hover border-2 border-sochimt-200 relative overflow-hidden">
        <div class="absolute top-0 right-0 bg-gradient-to-br from-yellow-400 to-orange-500 text-xs font-black text-white px-3 py-1 rounded-bl-xl">
          ‚≠ê NUEVO
        </div>
        <div class="w-16 h-16 bg-gradient-to-br from-sochimt-500 to-sochimt-600 rounded-2xl flex items-center justify-center mb-4 shadow-lg">
          <span class="text-4xl">üíß</span>
        </div>
        <h3 class="text-2xl font-black text-gray-900 mb-3">IA Gotita</h3>
        <p class="text-gray-600 mb-6">
          Tu asistente de IA especializado en medicina transfusional. Consulta criterios, protocolos y m√°s.
        </p>
        <button onclick="openGotita()" class="w-full bg-gradient-to-r from-sochimt-600 to-sochimt-700 text-white py-3 rounded-xl font-bold hover:from-sochimt-700 hover:to-sochimt-800 transition-all shadow-lg hover:shadow-xl transform hover:scale-105">
          üí¨ Iniciar Consulta
        </button>
        <p class="text-xs text-gray-500 mt-3 text-center">
          Consultas ilimitadas ‚Ä¢ Respuestas instant√°neas
        </p>
      </div>

      <!-- Conversatorios Card -->
      <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl shadow-xl p-8 card-hover border-2 border-purple-200 relative overflow-hidden">
        <div class="absolute top-0 right-0 bg-gradient-to-br from-purple-500 to-pink-500 text-xs font-black text-white px-3 py-1 rounded-bl-xl">
          üé• VIDEO
        </div>
        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-600 rounded-2xl flex items-center justify-center mb-4 shadow-lg">
          <span class="text-4xl">üé¨</span>
        </div>
        <h3 class="text-2xl font-black text-gray-900 mb-3">Conversatorios</h3>
        <p class="text-gray-600 mb-6">
          Accede a las grabaciones de todos los conversatorios SOCHIMT con expertos internacionales.
        </p>
        <a href="conversatorios.html" class="block w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-xl font-bold hover:from-purple-700 hover:to-pink-700 transition-all shadow-lg hover:shadow-xl transform hover:scale-105 text-center">
          üé• Ver Conversatorios
        </a>
        <p class="text-xs text-gray-500 mt-3 text-center">
          5 conversatorios disponibles
        </p>
      </div>

      <!-- Casos Cl√≠nicos Card -->
      <div class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl shadow-xl p-8 card-hover border-2 border-amber-200 relative overflow-hidden">
        <div class="absolute top-0 right-0 bg-gradient-to-br from-amber-500 to-orange-500 text-xs font-black text-white px-3 py-1 rounded-bl-xl">
          üî• POPULAR
        </div>
        <div class="w-16 h-16 bg-gradient-to-br from-amber-500 to-orange-600 rounded-2xl flex items-center justify-center mb-4 shadow-lg">
          <span class="text-4xl">üè•</span>
        </div>
        <h3 class="text-2xl font-black text-gray-900 mb-3">Casos Cl√≠nicos</h3>
        <p class="text-gray-600 mb-6">
          Casos cl√≠nicos interactivos para discusi√≥n y aprendizaje continuo en medicina transfusional.
        </p>
        <button onclick="abrirCasosClinicos()" class="w-full bg-gradient-to-r from-amber-500 to-orange-600 text-white py-3 rounded-xl font-bold hover:from-amber-600 hover:to-orange-700 transition-all shadow-lg hover:shadow-xl transform hover:scale-105">
          üìã Ver Casos
        </button>
        <p class="text-xs text-gray-500 mt-3 text-center">
          Caso del mes + archivo hist√≥rico
        </p>
      </div>

      <!-- Normativas Card -->
      <div class="bg-gradient-to-br from-slate-50 to-gray-100 rounded-2xl shadow-xl p-8 card-hover border-2 border-slate-200">
        <div class="w-16 h-16 bg-gradient-to-br from-slate-600 to-slate-800 rounded-2xl flex items-center justify-center mb-4 shadow-lg">
          <span class="text-4xl">üìú</span>
        </div>
        <h3 class="text-2xl font-black text-gray-900 mb-3">Normativas</h3>
        <p class="text-gray-600 mb-6">
          Acceso directo a normativas MINSAL, decretos y circulares vigentes sobre medicina transfusional.
        </p>
        <button onclick="abrirNormativas()" class="w-full bg-gradient-to-r from-slate-600 to-slate-800 text-white py-3 rounded-xl font-bold hover:from-slate-700 hover:to-slate-900 transition-all shadow-lg hover:shadow-xl transform hover:scale-105">
          üìÑ Ver Normativas
        </button>
        <p class="text-xs text-gray-500 mt-3 text-center">
          Actualizado 2025
        </p>
      </div>

      <!-- Eventos Card -->
      <div class="bg-gradient-to-br from-red-50 to-rose-50 rounded-2xl shadow-xl p-8 card-hover border-2 border-red-200">
        <div class="w-16 h-16 bg-gradient-to-br from-medical-500 to-medical-700 rounded-2xl flex items-center justify-center mb-4 shadow-lg">
          <span class="text-4xl">üìÖ</span>
        </div>
        <h3 class="text-2xl font-black text-gray-900 mb-3">Eventos</h3>
        <p class="text-gray-600 mb-6">
          Inscr√≠bete a webinars, cursos y congresos. Obt√©n descuentos exclusivos como socio.
        </p>
        <button onclick="alert('Pr√≥ximamente: Sistema de eventos')" class="w-full bg-gradient-to-r from-medical-600 to-medical-700 text-white py-3 rounded-xl font-bold hover:from-medical-700 hover:to-medical-800 transition-all shadow-lg hover:shadow-xl transform hover:scale-105">
          üìÖ Ver Calendario
        </button>
        <p class="text-xs text-gray-500 mt-3 text-center">
          Pr√≥ximo: Enero 2026
        </p>
      </div>

      <!-- Recursos Card -->
      <div class="bg-gradient-to-br from-cyan-50 to-sky-50 rounded-2xl shadow-xl p-8 card-hover border-2 border-cyan-200">
        <div class="w-16 h-16 bg-gradient-to-br from-cyan-500 to-sky-600 rounded-2xl flex items-center justify-center mb-4 shadow-lg">
          <span class="text-4xl">üì•</span>
        </div>
        <h3 class="text-2xl font-black text-gray-900 mb-3">Biblioteca</h3>
        <p class="text-gray-600 mb-6">
          Descarga gu√≠as, protocolos, formularios y presentaciones de congresos anteriores.
        </p>
        <button onclick="alert('Pr√≥ximamente: Biblioteca de recursos')" class="w-full bg-gradient-to-r from-cyan-500 to-sky-600 text-white py-3 rounded-xl font-bold hover:from-cyan-600 hover:to-sky-700 transition-all shadow-lg hover:shadow-xl transform hover:scale-105">
          üìö Ver Biblioteca
        </button>
        <p class="text-xs text-gray-500 mt-3 text-center">
          +100 recursos disponibles
        </p>
      </div>

    </div>

    <!-- Secci√≥n de Hemovigilancia y Alertas -->
    <div class="bg-gradient-to-r from-red-600 to-rose-700 rounded-3xl p-6 md:p-8 mb-8 shadow-2xl">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center animate-pulse">
            <span class="text-3xl">üö®</span>
          </div>
          <div>
            <h2 class="text-2xl font-black text-white">Hemovigilancia</h2>
            <p class="text-red-100 text-sm">Alertas y notificaciones del sistema nacional</p>
          </div>
        </div>
        <span class="bg-white/20 text-white text-xs font-bold px-3 py-1 rounded-full">
          0 alertas activas
        </span>
      </div>
      <div class="grid md:grid-cols-2 gap-4">
        <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-5 border border-white/20">
          <h3 class="text-lg font-bold text-white mb-2">üìä Reportar Reacci√≥n Adversa</h3>
          <p class="text-red-100 text-sm mb-3">Notifica reacciones adversas a la transfusi√≥n al sistema de hemovigilancia.</p>
          <button onclick="abrirReporteRAT()" class="bg-white text-red-600 px-4 py-2 rounded-lg font-bold text-sm hover:bg-red-50 transition-all">
            Crear Reporte
          </button>
        </div>
        <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-5 border border-white/20">
          <h3 class="text-lg font-bold text-white mb-2">üìã Mis Reportes</h3>
          <p class="text-red-100 text-sm mb-3">Consulta el estado de tus reportes enviados y su seguimiento.</p>
          <button onclick="verMisReportes()" class="bg-white text-red-600 px-4 py-2 rounded-lg font-bold text-sm hover:bg-red-50 transition-all">
            Ver Historial
          </button>
        </div>
      </div>
    </div>

    <!-- Activity Section -->
    <div class="bg-white rounded-2xl shadow-xl p-8 mb-8">
      <h2 class="text-2xl font-black text-gray-900 mb-6">Actividad Reciente</h2>
      
      <div id="recent-activity" class="space-y-4">
        <!-- Las actividades se cargar√°n din√°micamente -->
        <div class="text-center py-8 text-gray-500">
          <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
          <p>No hay actividad reciente</p>
        </div>
      </div>
    </div>

  </main>

  <!-- Footer -->
  <footer class="bg-white border-t py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-gray-600 text-sm">
      <p>&copy; 2025 SOCHIMT. Todos los derechos reservados.</p>
      <p class="mt-1 text-gray-500 text-xs">Desarrollado por Marcelo M√°rquez-Sandoval</p>
      <p class="mt-2">
        <a href="#" class="hover:text-sochimt-600">T√©rminos</a> ‚Ä¢
        <a href="#" class="hover:text-sochimt-600">Privacidad</a> ‚Ä¢
        <a href="mailto:soporte@sochimt.cl" class="hover:text-sochimt-600">Soporte</a>
      </p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/auth.js"></script>
  
  <script>
    // Verificar autenticaci√≥n al cargar la p√°gina
    requireAuth();
    
    // Verificar si es administrador o supervisor
    function esAdministrador(email, rol) {
      const adminEmails = ['marcelo@sochimt.cl', 'mmarquezsa@gmail.com'];
      return adminEmails.includes(email) || rol === 'admin' || rol === 'supervisor';
    }
    
    // Aplicar restricciones seg√∫n rol
    function aplicarRestriccionesRol(rol) {
      // Si es supervisor, ocultar opciones de eliminar y aprobar socios
      if (rol === 'supervisor') {
        // Deshabilitar botones de eliminar
        document.querySelectorAll('[data-accion="eliminar"]').forEach(btn => {
          btn.disabled = true;
          btn.classList.add('opacity-50', 'cursor-not-allowed');
          btn.title = 'Solo administradores pueden eliminar';
        });
        
        // Ocultar gesti√≥n de socios para supervisores
        const gestionSocios = document.querySelector('[onclick*="socios"]');
        if (gestionSocios) {
          gestionSocios.classList.add('opacity-50');
          gestionSocios.onclick = () => alert('Solo administradores pueden gestionar socios');
        }
      }
      
      // Si es socio normal, no deber√≠a ver el panel (ya est√° oculto)
      if (rol === 'socio') {
        const adminPanel = document.getElementById('admin-panel');
        if (adminPanel) adminPanel.classList.add('hidden');
      }
    }
    
    // Cargar datos del socio
    async function loadDashboardData() {
      try {
        const socio = await getSocioActual();
        
        // Actualizar nombre
        document.getElementById('user-name').textContent = socio.nombre_completo || 'Socio';
        
        // Actualizar mensaje de bienvenida
        const hora = new Date().getHours();
        let saludo = hora < 12 ? 'Buenos d√≠as' : hora < 19 ? 'Buenas tardes' : 'Buenas noches';
        document.getElementById('welcome-message').textContent = 
          `${saludo}, ${socio.nombre_completo?.split(' ')[0] || 'Socio'}. Tu membres√≠a est√° activa y lista para usar.`;
        
        // Actualizar estado de membres√≠a
        const statusElement = document.getElementById('membership-status');
        if (socio.estado === 'activo') {
          statusElement.textContent = '‚úÖ Activo';
          statusElement.classList.add('bg-green-500/30');
        } else if (socio.estado === 'pendiente') {
          statusElement.textContent = '‚è≥ Pendiente';
          statusElement.classList.add('bg-yellow-500/30');
        } else {
          statusElement.textContent = '‚ùå Inactivo';
          statusElement.classList.add('bg-red-500/30');
        }
        
        // Mostrar fecha de vencimiento si existe
        if (socio.fecha_vencimiento) {
          const fechaVenc = new Date(socio.fecha_vencimiento);
          const hoy = new Date();
          const diasRestantes = Math.ceil((fechaVenc - hoy) / (1000 * 60 * 60 * 24));
          
          if (diasRestantes > 0) {
            document.getElementById('membership-expiry').textContent = 
              `V√°lida por ${diasRestantes} d√≠as m√°s`;
          } else {
            document.getElementById('membership-expiry').textContent = 
              `‚ö†Ô∏è Membres√≠a vencida`;
          }
        }
        
        // Mostrar panel de administraci√≥n si corresponde
        if (esAdministrador(socio.email, socio.rol)) {
          const adminPanel = document.getElementById('admin-panel');
          adminPanel.classList.remove('hidden');
          
          // Actualizar badge de rol
          const rolBadge = document.getElementById('admin-role-badge');
          if (socio.rol === 'supervisor') {
            rolBadge.textContent = 'üîß Supervisor';
          } else {
            rolBadge.textContent = 'üëë Administrador';
          }
          
          // Aplicar restricciones seg√∫n rol
          aplicarRestriccionesRol(socio.rol || 'socio');
        }
        
        // Cargar estad√≠sticas
        await loadStats(socio.id);
        
      } catch (error) {
        console.error('Error al cargar dashboard:', error);
      }
    }
    
    // Cargar estad√≠sticas del socio
    async function loadStats(socioId) {
      try {
        // Consultas a Gotita
        const { count: consultasGotita } = await supabaseClient
          .from('conversaciones_gotita')
          .select('*', { count: 'exact', head: true })
          .eq('socio_id', socioId);
        
        document.getElementById('stat-gotita').textContent = consultasGotita || 0;
        
        // Eventos inscritos
        const { count: eventosInscritos } = await supabaseClient
          .from('inscripciones')
          .select('*', { count: 'exact', head: true })
          .eq('socio_id', socioId);
        
        document.getElementById('stat-eventos').textContent = eventosInscritos || 0;
        
        // Certificaciones
        const { count: certificaciones } = await supabaseClient
          .from('certificaciones')
          .select('*', { count: 'exact', head: true })
          .eq('socio_id', socioId);
        
        document.getElementById('stat-certificaciones').textContent = certificaciones || 0;
        
      } catch (error) {
        console.warn('Error al cargar estad√≠sticas:', error);
      }
    }
    
    // Funci√≥n para abrir Gotita (placeholder)
    function openGotita() {
      alert('üíß ¬°Pr√≥ximamente! El asistente IA Gotita estar√° disponible muy pronto.\n\nPodr√°s consultar sobre:\n‚Ä¢ Selecci√≥n de donantes\n‚Ä¢ Criterios de elegibilidad\n‚Ä¢ Protocolos transfusionales\n‚Ä¢ Y mucho m√°s...');
    }
    
    // ============================================
    // HERRAMIENTAS CL√çNICAS
    // ============================================
    
    // Calculadora de Hemocomponentes
    function abrirCalculadora() {
      const modal = document.createElement('div');
      modal.id = 'modal-calculadora';
      modal.className = 'fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4';
      modal.innerHTML = `
        <div class="bg-white rounded-3xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
          <div class="sticky top-0 bg-gradient-to-r from-emerald-500 to-teal-600 p-6 rounded-t-3xl">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <span class="text-4xl">üßÆ</span>
                <h2 class="text-2xl font-black text-white">Calculadora de Hemocomponentes</h2>
              </div>
              <button onclick="document.getElementById('modal-calculadora').remove()" class="text-white/80 hover:text-white">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>
          </div>
          <div class="p-6">
            <div class="grid gap-4 mb-6">
              <div>
                <label class="block text-sm font-bold text-gray-700 mb-2">Peso del paciente (kg)</label>
                <input type="number" id="calc-peso" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-emerald-500 focus:outline-none" placeholder="70">
              </div>
              <div>
                <label class="block text-sm font-bold text-gray-700 mb-2">Hematocrito actual (%)</label>
                <input type="number" id="calc-hto-actual" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-emerald-500 focus:outline-none" placeholder="25">
              </div>
              <div>
                <label class="block text-sm font-bold text-gray-700 mb-2">Hematocrito deseado (%)</label>
                <input type="number" id="calc-hto-deseado" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-emerald-500 focus:outline-none" placeholder="30">
              </div>
            </div>
            <button onclick="calcularDosis()" class="w-full bg-gradient-to-r from-emerald-500 to-teal-600 text-white py-4 rounded-xl font-black text-lg hover:from-emerald-600 hover:to-teal-700 transition-all">
              Calcular Dosis
            </button>
            <div id="resultado-calculo" class="mt-6 hidden">
              <h3 class="text-lg font-black text-gray-900 mb-4">üìä Resultados:</h3>
              <div class="grid gap-3" id="resultados-grid"></div>
            </div>
            <div class="mt-6 p-4 bg-amber-50 rounded-xl border border-amber-200">
              <p class="text-amber-800 text-sm"><strong>‚ö†Ô∏è Nota:</strong> Esta calculadora es una herramienta de apoyo. Siempre verifique los c√°lculos y considere las condiciones cl√≠nicas del paciente.</p>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    function calcularDosis() {
      const peso = parseFloat(document.getElementById('calc-peso').value);
      const htoActual = parseFloat(document.getElementById('calc-hto-actual').value);
      const htoDeseado = parseFloat(document.getElementById('calc-hto-deseado').value);
      
      if (!peso || !htoActual || !htoDeseado) {
        alert('Por favor complete todos los campos');
        return;
      }
      
      // Volumen sangu√≠neo estimado (70 mL/kg)
      const volSanguineo = peso * 70;
      
      // Unidades de GR necesarias (cada unidad aumenta Hto ~3%)
      const deltaHto = htoDeseado - htoActual;
      const unidadesGR = Math.ceil(deltaHto / 3);
      
      // Dosis de plaquetas (1 unidad/10kg para aumentar 5000-10000/uL)
      const unidadesPlaquetas = Math.ceil(peso / 10);
      
      // Plasma (10-15 mL/kg)
      const plasmaML = peso * 12;
      
      const resultadosDiv = document.getElementById('resultados-grid');
      resultadosDiv.innerHTML = `
        <div class="bg-red-50 p-4 rounded-xl border border-red-200">
          <p class="text-red-800 font-bold">ü©∏ Gl√≥bulos Rojos</p>
          <p class="text-2xl font-black text-red-600">${unidadesGR > 0 ? unidadesGR : 0} unidades</p>
          <p class="text-red-600 text-sm">Para aumentar Hto de ${htoActual}% a ${htoDeseado}%</p>
        </div>
        <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200">
          <p class="text-yellow-800 font-bold">üü° Plaquetas</p>
          <p class="text-2xl font-black text-yellow-600">${unidadesPlaquetas} unidades</p>
          <p class="text-yellow-600 text-sm">Dosis est√°ndar para peso ${peso}kg</p>
        </div>
        <div class="bg-blue-50 p-4 rounded-xl border border-blue-200">
          <p class="text-blue-800 font-bold">üíß Plasma Fresco</p>
          <p class="text-2xl font-black text-blue-600">${plasmaML} mL</p>
          <p class="text-blue-600 text-sm">10-15 mL/kg de peso</p>
        </div>
        <div class="bg-purple-50 p-4 rounded-xl border border-purple-200">
          <p class="text-purple-800 font-bold">üìä Volumen Sangu√≠neo</p>
          <p class="text-2xl font-black text-purple-600">${volSanguineo} mL</p>
          <p class="text-purple-600 text-sm">Estimado (70 mL/kg)</p>
        </div>
      `;
      document.getElementById('resultado-calculo').classList.remove('hidden');
    }
    
    // Tabla de Compatibilidad ABO/Rh
    function abrirCompatibilidad() {
      const modal = document.createElement('div');
      modal.id = 'modal-compatibilidad';
      modal.className = 'fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4';
      modal.innerHTML = `
        <div class="bg-white rounded-3xl max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
          <div class="sticky top-0 bg-gradient-to-r from-red-500 to-rose-600 p-6 rounded-t-3xl z-10">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <span class="text-4xl">ü©∏</span>
                <h2 class="text-2xl font-black text-white">Compatibilidad ABO/Rh</h2>
              </div>
              <button onclick="document.getElementById('modal-compatibilidad').remove()" class="text-white/80 hover:text-white">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>
          </div>
          <div class="p-6">
            <!-- Tabla Gl√≥bulos Rojos -->
            <h3 class="text-lg font-black text-gray-900 mb-4 flex items-center gap-2">
              <span class="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center text-white text-sm">GR</span>
              Compatibilidad para Gl√≥bulos Rojos
            </h3>
            <div class="overflow-x-auto mb-4">
              <table class="w-full text-sm">
                <thead>
                  <tr class="bg-red-100">
                    <th class="p-2 text-left font-bold text-red-800">Receptor</th>
                    <th class="p-2 text-center font-bold text-red-800">O-</th>
                    <th class="p-2 text-center font-bold text-red-800">O+</th>
                    <th class="p-2 text-center font-bold text-red-800">A-</th>
                    <th class="p-2 text-center font-bold text-red-800">A+</th>
                    <th class="p-2 text-center font-bold text-red-800">B-</th>
                    <th class="p-2 text-center font-bold text-red-800">B+</th>
                    <th class="p-2 text-center font-bold text-red-800">AB-</th>
                    <th class="p-2 text-center font-bold text-red-800">AB+</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="border-b"><td class="p-2 font-bold bg-red-50">O-</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td></tr>
                  <tr class="border-b"><td class="p-2 font-bold bg-red-50">O+</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td></tr>
                  <tr class="border-b"><td class="p-2 font-bold bg-red-50">A-</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td></tr>
                  <tr class="border-b"><td class="p-2 font-bold bg-red-50">A+</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td></tr>
                  <tr class="border-b"><td class="p-2 font-bold bg-red-50">B-</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td></tr>
                  <tr class="border-b"><td class="p-2 font-bold bg-red-50">B+</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td></tr>
                  <tr class="border-b"><td class="p-2 font-bold bg-red-50">AB-</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚ùå</td></tr>
                  <tr><td class="p-2 font-bold bg-red-50">AB+</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚úÖ</td></tr>
                </tbody>
              </table>
            </div>
            <div class="grid md:grid-cols-2 gap-3 mb-8">
              <div class="bg-green-50 p-3 rounded-xl border border-green-200">
                <p class="font-bold text-green-800 text-sm">ü©∏ Donante Universal GR</p>
                <p class="text-green-600 text-sm">O negativo (O-)</p>
              </div>
              <div class="bg-blue-50 p-3 rounded-xl border border-blue-200">
                <p class="font-bold text-blue-800 text-sm">ü©∏ Receptor Universal GR</p>
                <p class="text-blue-600 text-sm">AB positivo (AB+)</p>
              </div>
            </div>
            
            <!-- Tabla Plasma y Plaquetas -->
            <h3 class="text-lg font-black text-gray-900 mb-4 flex items-center gap-2">
              <span class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center text-white text-sm">PL</span>
              Compatibilidad para Plasma y Plaquetas
            </h3>
            <p class="text-gray-600 text-sm mb-4 bg-amber-50 p-3 rounded-lg border border-amber-200">
              ‚ö†Ô∏è <strong>Nota:</strong> Para plasma y plaquetas la compatibilidad es INVERSA a los gl√≥bulos rojos (se considera el plasma del donante con los GR del receptor).
            </p>
            <div class="overflow-x-auto mb-4">
              <table class="w-full text-sm">
                <thead>
                  <tr class="bg-yellow-100">
                    <th class="p-2 text-left font-bold text-yellow-800">Receptor</th>
                    <th class="p-2 text-center font-bold text-yellow-800">O</th>
                    <th class="p-2 text-center font-bold text-yellow-800">A</th>
                    <th class="p-2 text-center font-bold text-yellow-800">B</th>
                    <th class="p-2 text-center font-bold text-yellow-800">AB</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="border-b"><td class="p-2 font-bold bg-yellow-50">O</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚úÖ</td></tr>
                  <tr class="border-b"><td class="p-2 font-bold bg-yellow-50">A</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚úÖ</td></tr>
                  <tr class="border-b"><td class="p-2 font-bold bg-yellow-50">B</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚úÖ</td><td class="p-2 text-center">‚úÖ</td></tr>
                  <tr><td class="p-2 font-bold bg-yellow-50">AB</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚ùå</td><td class="p-2 text-center">‚úÖ</td></tr>
                </tbody>
              </table>
            </div>
            <div class="grid md:grid-cols-2 gap-3">
              <div class="bg-purple-50 p-3 rounded-xl border border-purple-200">
                <p class="font-bold text-purple-800 text-sm">üíß Donante Universal Plasma</p>
                <p class="text-purple-600 text-sm">AB (no tiene anticuerpos Anti-A ni Anti-B)</p>
              </div>
              <div class="bg-orange-50 p-3 rounded-xl border border-orange-200">
                <p class="font-bold text-orange-800 text-sm">üíß Receptor Universal Plasma</p>
                <p class="text-orange-600 text-sm">O (puede recibir de cualquier grupo)</p>
              </div>
            </div>
            
            <!-- Nota sobre Rh en plaquetas -->
            <div class="mt-6 p-4 bg-gray-50 rounded-xl border border-gray-200">
              <h4 class="font-bold text-gray-800 mb-2">üìã Consideraciones sobre Rh:</h4>
              <ul class="text-gray-600 text-sm space-y-1">
                <li>‚Ä¢ <strong>Plasma:</strong> El factor Rh NO es relevante para transfusi√≥n de plasma.</li>
                <li>‚Ä¢ <strong>Plaquetas:</strong> Preferir Rh compatible. En mujeres en edad f√©rtil Rh(-), evitar plaquetas Rh(+) o administrar inmunoglobulina anti-D.</li>
                <li>‚Ä¢ <strong>Crioprecipitado:</strong> Seguir las mismas reglas que el plasma.</li>
              </ul>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    // Criterios de Selecci√≥n de Donantes
    function abrirCriterios() {
      const modal = document.createElement('div');
      modal.id = 'modal-criterios';
      modal.className = 'fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4';
      modal.innerHTML = `
        <div class="bg-white rounded-3xl max-w-3xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
          <div class="sticky top-0 bg-gradient-to-r from-green-500 to-emerald-600 p-6 rounded-t-3xl">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <span class="text-4xl">‚úÖ</span>
                <h2 class="text-2xl font-black text-white">Criterios de Selecci√≥n de Donantes</h2>
              </div>
              <button onclick="document.getElementById('modal-criterios').remove()" class="text-white/80 hover:text-white">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>
          </div>
          <div class="p-6 space-y-4">
            <div class="bg-green-50 p-4 rounded-xl border border-green-200">
              <h3 class="font-bold text-green-800 mb-2">‚úÖ Requisitos B√°sicos</h3>
              <ul class="text-green-700 text-sm space-y-1">
                <li>‚Ä¢ Edad: 18-65 a√±os (hasta 60 primera vez)</li>
                <li>‚Ä¢ Peso m√≠nimo: 50 kg</li>
                <li>‚Ä¢ Hemoglobina: ‚â•12.5 g/dL (mujeres), ‚â•13.5 g/dL (hombres)</li>
                <li>‚Ä¢ Presi√≥n arterial: 90-180/60-100 mmHg</li>
                <li>‚Ä¢ Pulso: 50-100 lpm, regular</li>
                <li>‚Ä¢ Temperatura: ‚â§37.5¬∞C</li>
              </ul>
            </div>
            <div class="bg-red-50 p-4 rounded-xl border border-red-200">
              <h3 class="font-bold text-red-800 mb-2">‚ùå Diferimiento Permanente</h3>
              <ul class="text-red-700 text-sm space-y-1">
                <li>‚Ä¢ VIH, Hepatitis B o C</li>
                <li>‚Ä¢ Uso de drogas IV</li>
                <li>‚Ä¢ Enfermedad de Chagas</li>
                <li>‚Ä¢ Creutzfeldt-Jakob o variante</li>
                <li>‚Ä¢ Trasplante de √≥rganos/tejidos</li>
              </ul>
            </div>
            <div class="bg-amber-50 p-4 rounded-xl border border-amber-200">
              <h3 class="font-bold text-amber-800 mb-2">‚è≥ Diferimiento Temporal</h3>
              <ul class="text-amber-700 text-sm space-y-1">
                <li>‚Ä¢ Tatuajes/piercings: 12 meses</li>
                <li>‚Ä¢ Cirug√≠a mayor: 6-12 meses</li>
                <li>‚Ä¢ Embarazo: 6 meses post-parto</li>
                <li>‚Ä¢ Transfusi√≥n recibida: 12 meses</li>
                <li>‚Ä¢ Antibi√≥ticos: seg√∫n medicamento</li>
                <li>‚Ä¢ Viaje zona end√©mica malaria: 12 meses</li>
              </ul>
            </div>
            <div class="bg-blue-50 p-4 rounded-xl border border-blue-200">
              <h3 class="font-bold text-blue-800 mb-2">üìã Intervalos entre Donaciones</h3>
              <ul class="text-blue-700 text-sm space-y-1">
                <li>‚Ä¢ Sangre total: 3 meses (hombres), 4 meses (mujeres)</li>
                <li>‚Ä¢ Plaquetas por af√©resis: 15 d√≠as (m√°x 24/a√±o)</li>
                <li>‚Ä¢ Plasma por af√©resis: 15 d√≠as</li>
              </ul>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    // Funciones placeholder para otras herramientas
    function abrirCasosClinicos() {
      const modal = document.createElement('div');
      modal.id = 'modal-casos';
      modal.className = 'fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4';
      modal.innerHTML = `
        <div class="bg-white rounded-3xl max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
          <div class="sticky top-0 bg-gradient-to-r from-amber-500 to-orange-600 p-6 rounded-t-3xl z-10">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <span class="text-4xl">üè•</span>
                <div>
                  <h2 class="text-2xl font-black text-white">Caso Cl√≠nico del Mes</h2>
                  <p class="text-amber-100 text-sm">Inmunohematolog√≠a - Discrepancia ABO</p>
                </div>
              </div>
              <button onclick="document.getElementById('modal-casos').remove()" class="text-white/80 hover:text-white">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>
          </div>
          <div class="p-6 space-y-6">
            
            <!-- Presentaci√≥n del caso -->
            <div class="bg-blue-50 p-5 rounded-2xl border border-blue-200">
              <h3 class="text-lg font-black text-blue-800 mb-3 flex items-center gap-2">
                <span>üìã</span> Presentaci√≥n del Caso
              </h3>
              <p class="text-blue-900 mb-3">
                <strong>Paciente:</strong> Mujer de 78 a√±os, ingresa a urgencias por cuadro de anemia severa secundaria a hemorragia digestiva alta.
              </p>
              <p class="text-blue-900 mb-3">
                <strong>Antecedentes:</strong> Mieloma m√∫ltiple en tratamiento con quimioterapia. Sin antecedentes transfusionales previos ni embarazos.
              </p>
              <p class="text-blue-900">
                <strong>Solicitud:</strong> Se solicita tipificaci√≥n ABO/Rh y pruebas de compatibilidad para transfusi√≥n de 2 unidades de gl√≥bulos rojos.
              </p>
            </div>
            
            <!-- Resultados iniciales -->
            <div class="bg-red-50 p-5 rounded-2xl border border-red-200">
              <h3 class="text-lg font-black text-red-800 mb-3 flex items-center gap-2">
                <span>üî¨</span> Resultados de Tipificaci√≥n ABO/Rh
              </h3>
              <div class="grid md:grid-cols-2 gap-4">
                <div class="bg-white p-4 rounded-xl border border-red-200">
                  <h4 class="font-bold text-red-700 mb-2">Prueba Globular (Directa)</h4>
                  <table class="w-full text-sm">
                    <tr class="border-b"><td class="py-1">Anti-A:</td><td class="py-1 font-bold text-green-600">4+ (Positivo)</td></tr>
                    <tr class="border-b"><td class="py-1">Anti-B:</td><td class="py-1 font-bold text-red-600">Negativo</td></tr>
                    <tr><td class="py-1">Anti-D:</td><td class="py-1 font-bold text-green-600">3+ (Positivo)</td></tr>
                  </table>
                  <p class="mt-2 text-sm font-bold text-red-800">Interpretaci√≥n: Grupo A Rh(D) Positivo</p>
                </div>
                <div class="bg-white p-4 rounded-xl border border-red-200">
                  <h4 class="font-bold text-red-700 mb-2">Prueba S√©rica (Inversa)</h4>
                  <table class="w-full text-sm">
                    <tr class="border-b"><td class="py-1">C√©lulas A1:</td><td class="py-1 font-bold text-red-600">Negativo ‚ö†Ô∏è</td></tr>
                    <tr><td class="py-1">C√©lulas B:</td><td class="py-1 font-bold text-red-600">Negativo ‚ö†Ô∏è</td></tr>
                  </table>
                  <p class="mt-2 text-sm font-bold text-amber-700">‚ö†Ô∏è DISCREPANCIA: Se esperaba Anti-B positivo</p>
                </div>
              </div>
            </div>
            
            <!-- An√°lisis de la discrepancia -->
            <div class="bg-amber-50 p-5 rounded-2xl border border-amber-200">
              <h3 class="text-lg font-black text-amber-800 mb-3 flex items-center gap-2">
                <span>üîç</span> An√°lisis de la Discrepancia
              </h3>
              <p class="text-amber-900 mb-3">
                <strong>Tipo de discrepancia:</strong> Discrepancia en prueba s√©rica (inversa) - Ausencia de anticuerpos esperados.
              </p>
              <p class="text-amber-900 mb-3">
                <strong>Causas posibles a investigar:</strong>
              </p>
              <ul class="list-disc list-inside text-amber-800 space-y-1 ml-4">
                <li>Hipogammaglobulinemia (com√∫n en mieloma m√∫ltiple)</li>
                <li>Inmunosupresi√≥n por quimioterapia</li>
                <li>Edad avanzada (disminuci√≥n fisiol√≥gica de anticuerpos)</li>
                <li>Reci√©n nacidos (no aplica en este caso)</li>
                <li>Trasplante de m√©dula √≥sea ABO incompatible</li>
              </ul>
            </div>
            
            <!-- Investigaci√≥n -->
            <div class="bg-purple-50 p-5 rounded-2xl border border-purple-200">
              <h3 class="text-lg font-black text-purple-800 mb-3 flex items-center gap-2">
                <span>üß™</span> Protocolo de Investigaci√≥n
              </h3>
              
              <div class="space-y-4">
                <div class="bg-white p-4 rounded-xl border border-purple-200">
                  <h4 class="font-bold text-purple-700 mb-2">1. Verificaci√≥n de la muestra</h4>
                  <ul class="text-purple-800 text-sm space-y-1">
                    <li>‚úÖ Identificaci√≥n correcta del paciente</li>
                    <li>‚úÖ Muestra sin hem√≥lisis ni lipemia</li>
                    <li>‚úÖ Repetici√≥n de pruebas con nueva muestra: mismo resultado</li>
                  </ul>
                </div>
                
                <div class="bg-white p-4 rounded-xl border border-purple-200">
                  <h4 class="font-bold text-purple-700 mb-2">2. Potenciaci√≥n de la prueba s√©rica</h4>
                  <ul class="text-purple-800 text-sm space-y-1">
                    <li>‚Ä¢ Incubaci√≥n prolongada a temperatura ambiente (30 min): <strong>Negativo</strong></li>
                    <li>‚Ä¢ Incubaci√≥n a 4¬∞C por 30 minutos: <strong>Anti-B d√©bil (1+)</strong></li>
                    <li>‚Ä¢ Uso de c√©lulas B de pool de 3 donantes: <strong>Anti-B d√©bil (1+)</strong></li>
                  </ul>
                </div>
                
                <div class="bg-white p-4 rounded-xl border border-purple-200">
                  <h4 class="font-bold text-purple-700 mb-2">3. Estudios complementarios</h4>
                  <ul class="text-purple-800 text-sm space-y-1">
                    <li>‚Ä¢ Electroforesis de prote√≠nas: <strong>Pico monoclonal IgG kappa</strong></li>
                    <li>‚Ä¢ Inmunoglobulinas s√©ricas:</li>
                    <li class="ml-4">- IgG: 450 mg/dL (VN: 700-1600) ‚Üì</li>
                    <li class="ml-4">- IgM: 25 mg/dL (VN: 40-230) ‚Üì‚Üì</li>
                    <li class="ml-4">- IgA: 35 mg/dL (VN: 70-400) ‚Üì</li>
                    <li>‚Ä¢ Prueba de Coombs Directo: <strong>Negativo</strong></li>
                  </ul>
                </div>
                
                <div class="bg-white p-4 rounded-xl border border-purple-200">
                  <h4 class="font-bold text-purple-700 mb-2">4. Prueba de adsorci√≥n-eluci√≥n (confirmaci√≥n grupo A)</h4>
                  <ul class="text-purple-800 text-sm space-y-1">
                    <li>‚Ä¢ Adsorci√≥n con c√©lulas A1: <strong>Positiva</strong></li>
                    <li>‚Ä¢ Eluci√≥n: <strong>Anti-A detectado</strong></li>
                    <li>‚Ä¢ Conclusi√≥n: Confirma ant√≠geno A presente en los gl√≥bulos rojos</li>
                  </ul>
                </div>
              </div>
            </div>
            
            <!-- Diagn√≥stico -->
            <div class="bg-green-50 p-5 rounded-2xl border border-green-200">
              <h3 class="text-lg font-black text-green-800 mb-3 flex items-center gap-2">
                <span>‚úÖ</span> Diagn√≥stico Final
              </h3>
              <div class="bg-white p-4 rounded-xl border border-green-300">
                <p class="text-green-900 font-bold text-lg mb-2">Grupo Sangu√≠neo: A Rh(D) Positivo</p>
                <p class="text-green-800 mb-3">
                  <strong>Causa de la discrepancia:</strong> Hipogammaglobulinemia secundaria a mieloma m√∫ltiple, con disminuci√≥n marcada de IgM (isotipo predominante de los anticuerpos ABO naturales), resultando en ausencia/debilidad del Anti-B esperado.
                </p>
              </div>
            </div>
            
            <!-- Conducta -->
            <div class="bg-slate-50 p-5 rounded-2xl border border-slate-200">
              <h3 class="text-lg font-black text-slate-800 mb-3 flex items-center gap-2">
                <span>üíâ</span> Conducta Transfusional
              </h3>
              <ul class="text-slate-800 space-y-2">
                <li>‚úÖ Se confirma grupo A Rh(D) Positivo para transfusi√≥n</li>
                <li>‚úÖ Pruebas de compatibilidad con unidades grupo A Rh(D) Positivo: <strong>Compatibles</strong></li>
                <li>‚úÖ Se transfunden 2 unidades de GR sin incidentes</li>
                <li>‚ö†Ô∏è Se documenta la discrepancia en el historial del paciente</li>
                <li>‚ö†Ô∏è Se recomienda tipificaci√≥n con t√©cnicas potenciadas en futuras muestras</li>
              </ul>
            </div>
            
            <!-- Puntos clave -->
            <div class="bg-indigo-50 p-5 rounded-2xl border border-indigo-200">
              <h3 class="text-lg font-black text-indigo-800 mb-3 flex items-center gap-2">
                <span>üí°</span> Puntos Clave de Aprendizaje
              </h3>
              <ol class="text-indigo-800 space-y-2 list-decimal list-inside">
                <li>Las discrepancias ABO s√©ricas por ausencia de anticuerpos son comunes en pacientes con hipogammaglobulinemia.</li>
                <li>El mieloma m√∫ltiple causa inmunoparesia con disminuci√≥n de inmunoglobulinas policlonales.</li>
                <li>La incubaci√≥n a 4¬∞C puede potenciar anticuerpos ABO d√©biles.</li>
                <li>La prueba globular (directa) es m√°s confiable que la s√©rica en estos casos.</li>
                <li>Siempre documentar las discrepancias resueltas para futuras referencias.</li>
              </ol>
            </div>
            
            <!-- Referencias -->
            <div class="text-center text-gray-500 text-xs pt-4 border-t">
              <p>Caso cl√≠nico educativo - SOCHIMT 2025</p>
              <p>Basado en literatura de inmunohematolog√≠a y casos reales anonimizados</p>
            </div>
            
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    function abrirNormativas() {
      alert('üìú Normativas\n\nPr√≥ximamente acceso directo a:\n‚Ä¢ Decreto 1.587 - Reglamento de Bancos de Sangre\n‚Ä¢ Norma T√©cnica N¬∞146 MINSAL\n‚Ä¢ Circulares vigentes\n‚Ä¢ Gu√≠as cl√≠nicas actualizadas');
    }
    
    function abrirReporteRAT() {
      alert('üö® Reporte de Reacci√≥n Adversa\n\nPr√≥ximamente:\n‚Ä¢ Formulario de notificaci√≥n RAT\n‚Ä¢ Clasificaci√≥n seg√∫n gravedad\n‚Ä¢ Seguimiento autom√°tico\n‚Ä¢ Conexi√≥n con sistema ISP');
    }
    
    function verMisReportes() {
      alert('üìã Mis Reportes\n\nPr√≥ximamente:\n‚Ä¢ Historial de reportes enviados\n‚Ä¢ Estado de seguimiento\n‚Ä¢ Estad√≠sticas personales');
    }
    
    // Funci√≥n para abrir gestores de contenido (solo admin/supervisor)
    async function openContentManager(tipo) {
      if (tipo === 'socios') {
        await abrirGestionSocios();
      } else {
        const mensajes = {
          'articulos': 'üìù Pr√≥ximamente: Sistema de gesti√≥n de art√≠culos\n\n‚Ä¢ Crear y editar art√≠culos\n‚Ä¢ Categor√≠as y tags\n‚Ä¢ Editor WYSIWYG\n‚Ä¢ Programar publicaciones',
          'eventos': 'üìÖ Pr√≥ximamente: Sistema de gesti√≥n de eventos\n\n‚Ä¢ Crear webinars y cursos\n‚Ä¢ Configurar inscripciones\n‚Ä¢ Descuentos para socios\n‚Ä¢ Env√≠o de certificados',
          'recursos': 'üì• Pr√≥ximamente: Sistema de gesti√≥n de recursos\n\n‚Ä¢ Subir PDFs y documentos\n‚Ä¢ Categor√≠as y etiquetas\n‚Ä¢ Control de acceso\n‚Ä¢ Estad√≠sticas de descargas'
        };
        
        alert(mensajes[tipo] || 'Funci√≥n en desarrollo');
      }
    }

    // Abrir panel de gesti√≥n de socios
    async function abrirGestionSocios() {
      try {
        // Cargar socios pendientes
        const { data: sociosPendientes, error } = await supabaseClient
          .from('socios')
          .select('*')
          .eq('estado', 'pendiente')
          .order('created_at', { ascending: false });

        if (error) {
          alert('Error al cargar socios pendientes: ' + error.message);
          return;
        }

        if (!sociosPendientes || sociosPendientes.length === 0) {
          alert('‚úÖ No hay solicitudes pendientes de aprobaci√≥n');
          return;
        }

        // Crear modal con la lista de socios pendientes
        const modal = document.createElement('div');
        modal.id = 'modal-socios';
        modal.className = 'fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4';
        modal.innerHTML = `
          <div class="bg-white rounded-3xl max-w-6xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            <div class="sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between">
              <h2 class="text-2xl font-black text-gray-900">Gesti√≥n de Socios - Solicitudes Pendientes</h2>
              <button onclick="document.getElementById('modal-socios').remove()" class="text-gray-500 hover:text-gray-700">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>
            <div class="p-6">
              <div class="grid md:grid-cols-2 gap-6">
                ${sociosPendientes.map(socio => `
                  <div class="bg-gray-50 rounded-xl p-6 border-2 border-gray-200">
                    <div class="flex items-start space-x-4 mb-4">
                      <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-2xl text-white font-bold">${socio.nombre_completo.charAt(0)}</span>
                      </div>
                      <div class="flex-1">
                        <h3 class="text-lg font-bold text-gray-900">${socio.nombre_completo}</h3>
                        <p class="text-sm text-gray-600">${socio.especialidad || 'No especificado'}</p>
                        <p class="text-xs text-gray-500">${socio.email}</p>
                      </div>
                    </div>
                    <div class="space-y-2 text-sm text-gray-600 mb-4">
                      <p><strong>RUT:</strong> ${socio.rut || 'No especificado'}</p>
                      <p><strong>Ciudad:</strong> ${socio.ciudad || 'No especificado'}</p>
                      <p><strong>Tel√©fono:</strong> ${socio.telefono || 'No especificado'}</p>
                      <p><strong>Tipo:</strong> ${socio.tipo_membresia || 'Regular'}</p>
                    </div>
                    <div class="flex space-x-3">
                      <button onclick="aprobarSocio('${socio.id}')" 
                              class="flex-1 bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-lg font-bold transition-all">
                        ‚úÖ Aprobar
                      </button>
                      <button onclick="rechazarSocio('${socio.id}')"
                              class="flex-1 bg-red-500 hover:bg-red-600 text-white px-4 py-3 rounded-lg font-bold transition-all">
                        ‚ùå Rechazar
                      </button>
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
        
      } catch (err) {
        alert('Error: ' + err.message);
      }
    }

    // Aprobar socio
    async function aprobarSocio(socioId) {
      if (!confirm('¬øConfirmas que deseas aprobar esta membres√≠a?')) return;

      try {
        const fechaVencimiento = new Date();
        fechaVencimiento.setFullYear(fechaVencimiento.getFullYear() + 1);

        const { error } = await supabaseClient
          .from('socios')
          .update({
            estado: 'activo',
            fecha_vencimiento: fechaVencimiento.toISOString().split('T')[0]
          })
          .eq('id', socioId);

        if (error) throw error;

        alert('‚úÖ Membres√≠a aprobada exitosamente! El socio ahora aparecer√° en la secci√≥n "Nuevos Socios"');
        document.getElementById('modal-socios').remove();
        
      } catch (err) {
        alert('Error al aprobar: ' + err.message);
      }
    }

    // Rechazar socio
    async function rechazarSocio(socioId) {
      if (!confirm('¬øConfirmas que deseas rechazar esta solicitud?')) return;

      try {
        const { error } = await supabaseClient
          .from('socios')
          .update({ estado: 'rechazado' })
          .eq('id', socioId);

        if (error) throw error;

        alert('‚ùå Solicitud rechazada');
        document.getElementById('modal-socios').remove();
        
      } catch (err) {
        alert('Error al rechazar: ' + err.message);
      }
    }
    
    // Cargar datos al iniciar
    loadDashboardData();
  </script>
</body>
</html>
